import{a as T,I as $e,s as _e}from"../chunks/Icon.yFnM2WBm.js";import{d as le,e as xe,c as $,a as g,t as N,b as Ke}from"../chunks/disclose-version.DTAQul2H.js";import{h as Ue,l as de,z as ce,i as ze,o as me,aw as qe,aQ as De,aP as je,J as Oe,as as Be,k as He,f as b,p as O,a as B,t as te,s as A,R as E,T as pe,g as k,m as D,N as P,b as j,c as G,r as J,n as ue}from"../chunks/runtime.B4QXH2CN.js";import{k as Qe,s as ye,b as Y,a as Fe}from"../chunks/store.D_on7m4h.js";import{i as R}from"../chunks/if.DRLG6bOh.js";import{i as H}from"../chunks/lifecycle.DAFDPKuL.js";/* empty css                         */import{g as I}from"../chunks/entry.Dq_-L3Yi.js";import{o as be}from"../chunks/index-client.Bib29rnf.js";import{p as Ge}from"../chunks/stores.BoiHb4t-.js";import{u as V,S as Je,A as Ye,a as We,b as Xe,d as Ze,B as fe}from"../chunks/app-sidebar.DemYhRv9.js";import{S as et,M as tt}from"../chunks/Login.C-5mXFN0.js";import{g as re,d as we,w as C}from"../chunks/index.BaSQ6CZM.js";import{l as rt,s as st,p as _}from"../chunks/preload-helper.B2IhT0O3.js";import{s as Se}from"../chunks/attributes.DPN48yOH.js";function at(s,e,o,r,i){var d=s,t="",n;Ue(()=>{if(t===(t=e()??"")){de&&ce();return}n!==void 0&&(He(n),n=void 0),t!==""&&(n=ze(()=>{if(de){me.data;for(var a=ce(),c=a;a!==null&&(a.nodeType!==8||a.data!=="");)c=a,a=qe(a);if(a===null)throw De(),je;le(me,c),d=Oe(a);return}var u=t+"",l=xe(u);le(Be(l),l.lastChild),d.before(l)}))})}const ot=async()=>{const{data:{session:s}}=await T.auth.getSession(),{data:{user:e}}=await T.auth.getUser();return{supabase:T,user:e,session:s}},Qt=Object.freeze(Object.defineProperty({__proto__:null,load:ot},Symbol.toStringTag,{value:"Module"}));function nt(s,e){const o=rt(e,["children","$$slots","$$events","$$legacy"]);$e(s,st({name:"bell"},()=>o,{iconNode:[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"}]],children:(i,d)=>{var t=$(),n=b(t);_e(n,e,"default",{}),g(i,t)},$$slots:{default:!0}}))}let he,ge;function ke(s){if(typeof document>"u")return;clearTimeout(he),clearTimeout(ge);const e=document.createElement("style"),o=document.createTextNode(`* {
     -webkit-transition: none !important;
     -moz-transition: none !important;
     -o-transition: none !important;
     -ms-transition: none !important;
     transition: none !important;
  }`);e.appendChild(o);const r=()=>document.head.appendChild(e),i=()=>document.head.removeChild(e);if(typeof window.getComputedStyle<"u"){r(),s(),window.getComputedStyle(e).opacity,i();return}if(typeof window.requestAnimationFrame<"u"){r(),s(),window.requestAnimationFrame(i);return}r(),he=window.setTimeout(()=>{s(),ge=window.setTimeout(i,120)},120)}function ve(s){return s.filter(e=>e.length>0)}const Ne={getItem:s=>null,setItem:(s,e)=>{}},L=typeof document<"u",it=["dark","light","system"],W=C("mode-watcher-mode"),X=C("mode-watcher-theme"),se=dt(),Z=mt(),Me=C(void 0),Ee=ct(),ae=C(!0),Te=C([]),Ce=C([]),Ie=ut(),lt=ft();function dt(){const s="system",e=L?localStorage:Ne,o=e.getItem(i());let r=ee(o)?o:s;function i(){return re(W)}const{subscribe:d,set:t}=C(r,()=>{if(!L)return;const a=c=>{if(c.key!==i())return;const u=c.newValue;ee(u)?t(r=u):t(r=s)};return addEventListener("storage",a),()=>removeEventListener("storage",a)});function n(a){t(r=a),e.setItem(i(),r)}return{subscribe:d,set:n}}function ct(){const s=L?localStorage:Ne,e=s.getItem(r());let o=e??"";function r(){return re(X)}const{subscribe:i,set:d}=C(o,()=>{if(!L)return;const n=a=>{if(a.key!==r())return;const c=a.newValue;d(c===null?o="":o=c)};return addEventListener("storage",n),()=>removeEventListener("storage",n)});function t(n){d(o=n),s.setItem(r(),o)}return{subscribe:i,set:t}}function mt(){let e=!0;const{subscribe:o,set:r}=C(void 0,()=>{if(!L)return;const t=a=>{e&&r(a.matches?"light":"dark")},n=window.matchMedia("(prefers-color-scheme: light)");return n.addEventListener("change",t),()=>n.removeEventListener("change",t)});function i(){if(!L)return;const t=window.matchMedia("(prefers-color-scheme: light)");r(t.matches?"light":"dark")}function d(t){e=t}return{subscribe:o,query:i,tracking:d}}function ut(){const{subscribe:s}=we([se,Z,Me,ae,Te,Ce],([e,o,r,i,d,t])=>{if(!L)return;const n=e==="system"?o:e,a=ve(d),c=ve(t);function u(){const l=document.documentElement,h=document.querySelector('meta[name="theme-color"]');n==="light"?(a.length&&l.classList.remove(...a),c.length&&l.classList.add(...c),l.style.colorScheme="light",h&&r&&h.setAttribute("content",r.light)):(c.length&&l.classList.remove(...c),a.length&&l.classList.add(...a),l.style.colorScheme="dark",h&&r&&h.setAttribute("content",r.dark))}return i?ke(u):u(),n});return{subscribe:s}}function ft(){const{subscribe:s}=we([Ee,ae],([e,o])=>{if(!L)return;function r(){document.documentElement.setAttribute("data-theme",e)}return o?ke(r):r(),e});return{subscribe:s}}function ee(s){return typeof s!="string"?!1:it.includes(s)}function ht(){se.set(re(Ie)==="dark"?"light":"dark")}function gt(s){se.set(s)}function vt(s){Ee.set(s)}function _t({defaultMode:s="system",themeColors:e,darkClassNames:o=["dark"],lightClassNames:r=[],defaultTheme:i="",modeStorageKey:d="mode-watcher-mode",themeStorageKey:t="mode-watcher-theme"}){const n=document.documentElement,a=localStorage.getItem(d)||s,c=localStorage.getItem(t)||i,u=a==="light"||a==="system"&&window.matchMedia("(prefers-color-scheme: light)").matches;if(u?(o.length&&n.classList.remove(...o),r.length&&n.classList.add(...r)):(r.length&&n.classList.remove(...r),o.length&&n.classList.add(...o)),n.style.colorScheme=u?"light":"dark",e){const l=document.querySelector('meta[name="theme-color"]');l&&l.setAttribute("content",a==="light"?e.light:e.dark)}c&&(n.setAttribute("data-theme",c),localStorage.setItem(t,c)),localStorage.setItem(d,a)}var pt=N('<meta name="theme-color">');function yt(s,e){O(e,!1);let o=_(e,"themeColors",24,()=>{});H();var r=$(),i=b(r);R(i,o,d=>{var t=pt();te(()=>Se(t,"content",o().dark)),g(d,t)}),g(s,r),B()}var bt=N('<meta name="theme-color">'),wt=N("<!> <!>",1);function St(s,e){O(e,!1);let o=_(e,"trueNonce",8,""),r=_(e,"initConfig",8),i=_(e,"themeColors",24,()=>{});H(),Qe(d=>{var t=wt(),n=b(t);R(n,i,c=>{var u=bt();te(()=>Se(u,"content",i().dark)),g(c,u)});var a=A(n,2);at(a,()=>`<script${o()?` nonce=${o()}`:""}>(`+_t.toString()+")("+JSON.stringify(r())+");<\/script>",!1,!1),g(d,t)}),B()}function kt(s,e){O(e,!1);const o=ye(),r=()=>Y(W,"$modeStorageKeyStore",o),i=()=>Y(X,"$themeStorageKeyStore",o),d=D();let t=_(e,"track",8,!0),n=_(e,"defaultMode",8,"system"),a=_(e,"themeColors",24,()=>{}),c=_(e,"disableTransitions",8,!0),u=_(e,"darkClassNames",24,()=>["dark"]),l=_(e,"lightClassNames",24,()=>[]),h=_(e,"defaultTheme",8,""),w=_(e,"nonce",8,""),f=_(e,"themeStorageKey",8,"mode-watcher-theme"),M=_(e,"modeStorageKey",8,"mode-watcher-mode"),v=_(e,"disableHeadScriptInjection",8,!1);be(()=>{const p=Ie.subscribe(()=>{}),z=lt.subscribe(()=>{});Z.tracking(t()),Z.query();const x=localStorage.getItem(r());gt(ee(x)?x:n());const K=localStorage.getItem(i());return vt(K||h()),()=>{p(),z()}});const y={defaultMode:n(),themeColors:a(),darkClassNames:u(),lightClassNames:l(),defaultTheme:h(),modeStorageKey:M(),themeStorageKey:f()};E(()=>P(c()),()=>{ae.set(c())}),E(()=>P(a()),()=>{Me.set(a())}),E(()=>P(u()),()=>{Te.set(u())}),E(()=>P(l()),()=>{Ce.set(l())}),E(()=>P(M()),()=>{W.set(M())}),E(()=>P(f()),()=>{X.set(f())}),E(()=>P(w()),()=>{j(d,typeof window>"u"?w():"")}),pe(),H();var m=$(),S=b(m);R(S,v,p=>{yt(p,{get themeColors(){return a()}})},p=>{St(p,{get trueNonce(){return k(d)},initConfig:y,get themeColors(){return a()}})}),g(s,m),B()}var Nt=N('<div class="flex items-center justify-center min-h-screen "><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Mt=N('<!> <!> <span class="sr-only">Toggle theme</span>',1),Et=N('<!> <span class="sr-only">Notifications</span>',1),Tt=N('<header class="flex h-16 shrink-0 items-center justify-between gap-2 transition-[width,height] ease-linear group-has-[[data-collapsible=icon]]/sidebar-wrapper:h-12 sticky top-0  z-10"><div class="flex items-center gap-2 px-4"><!> <!></div> <div class="flex items-center gap-3 pr-4"><!> <!></div></header> <!>',1),Ct=N("<!> <!>",1),It=N('<div class="flex items-center justify-center min-h-screen "><div class="text-center"><h1 class="text-4xl font-bold  mb-4">Pending for System Access</h1> <p>Your account is under review. Please wait for verification.</p></div></div>'),At=N("<!> <!>",1);function Ft(s,e){O(e,!1);const o=ye(),r=()=>Y(Ge,"$page",o),i=D();let d=D(!0),t=D({session:null,isVerified:!1,userRole:null,profilePic:null,email:null,departmentName:""});const n=async()=>{var l,h,w;try{if(!k(t).session){const{data:m,error:S}=await T.auth.getSession();if(S||!(m!=null&&m.session)){console.log("No active session found. Redirecting to /login."),I("/");return}V.update(p=>({...p,session:m.session}))}const{session:f}=k(t);if(f.expires_at-Math.floor(Date.now()/1e3)<300){console.log("Token is expiring soon. Refreshing session...");const{data:m,error:S}=await T.auth.refreshSession();if(S){console.error("Error refreshing session:",S.message),I("/");return}else console.log("Session refreshed successfully."),V.update(p=>({...p,session:m.session}))}const{data:v,error:y}=await T.from("profiles").select("id, role, is_verified, profile_pic, department_id, email, first_name, last_name").eq("id",f.user.id).single();if(y)if(y.code==="PGRST116"){console.log("User not found. Adding new user profile.");const{error:m}=await T.from("profiles").insert({id:f.user.id,email:f.user.email,first_name:((l=f.user.user_metadata)==null?void 0:l.first_name)||"New",last_name:((h=f.user.user_metadata)==null?void 0:h.last_name)||"User",role:"user",is_verified:!1});if(m){console.error("Error adding user profile:",m.message),I("/");return}}else{console.error("Error fetching profile:",y.message),I("/");return}v&&(V.set({session:f,isVerified:v.is_verified??!1,userRole:v.role??null,profilePic:v.profile_pic,email:v.email,departmentName:v.department_id?((w=(await T.from("departments").select("name").eq("id",v.department_id).single()).data)==null?void 0:w.name)??"No Department":"",firstName:v.first_name||"New",lastName:v.last_name||"User"}),v.is_verified&&k(i)==="/"&&(console.log("Redirecting to /dashboard."),I("/dashboard")))}catch(f){console.error("Error during session refresh and check:",f),I("/")}finally{j(d,!1)}};be(()=>{n();const{data:l}=T.auth.onAuthStateChange((h,w)=>{h==="SIGNED_OUT"?(console.log("User signed out, redirecting to /."),V.set({session:null,isVerified:!1,userRole:null,profilePic:null,email:null,departmentName:"",firstName:"New",lastName:"User"}),I("/")):w&&(console.log("User signed in or session updated."),V.update(f=>({...f,session:w})),n())});return()=>{l.subscription.unsubscribe()}}),E(()=>r(),()=>{j(i,r().url.pathname)}),E(()=>V,()=>{V.subscribe(l=>{j(t,l)})}),pe(),H();var a=At(),c=b(a);kt(c,{});var u=A(c,2);R(u,()=>k(d),l=>{var h=Nt();g(l,h)},l=>{var h=$(),w=b(h);R(w,()=>k(t).session&&k(t).isVerified,f=>{Je(f,{children:(M,v)=>{var y=Ct(),m=b(y);Ye(m,{get userRole(){return k(t).userRole}});var S=A(m,2);We(S,{children:(p,z)=>{var x=Tt(),K=b(x),Q=G(K),oe=G(Q);Xe(oe,{class:"-ml-1"});var Ae=A(oe,2);Ze(Ae,{orientation:"vertical",class:"mr-2 h-4"}),J(Q);var ne=A(Q,2),ie=G(ne);fe(ie,{onclick:ht,variant:"outline",size:"icon",children:(F,Ve)=>{var U=Mt(),q=b(U);et(q,{class:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"});var Re=A(q,2);tt(Re,{class:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),ue(2),g(F,U)},$$slots:{default:!0}});var Le=A(ie,2);fe(Le,{variant:"outline",size:"icon",onclick:()=>alert("Notifications clicked! This feature is not yet available."),children:(F,Ve)=>{var U=Et(),q=b(U);nt(q,{class:"h-[1.2rem] w-[1.2rem]"}),ue(2),g(F,U)},$$slots:{default:!0}}),J(ne),J(K);var Pe=A(K,2);_e(Pe,e,"default",{}),g(p,x)},$$slots:{default:!0}}),g(M,y)},$$slots:{default:!0}})},f=>{var M=$(),v=b(M);R(v,()=>!k(t).session,y=>{var m=Ke();te(()=>Fe(m,I("/"))),g(y,m)},y=>{var m=$(),S=b(m);R(S,()=>!k(t).isVerified,p=>{var z=It();g(p,z)},null,!0),g(y,m)},!0),g(f,M)},!0),g(l,h)}),g(s,a),B()}export{Ft as component,Qt as universal};
