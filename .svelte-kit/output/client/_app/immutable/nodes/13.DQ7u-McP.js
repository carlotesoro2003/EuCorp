import{a as h,t as y,c as Dt}from"../chunks/disclose-version.DTAQul2H.js";import{p as ct,d as u,c as r,r as a,s as l,t as A,b as n,g as e,a as dt,f as lt,O as ut,n as de,e as J}from"../chunks/runtime.B4QXH2CN.js";import{d as vt,e as Tt,a as f}from"../chunks/store.D_on7m4h.js";import{i as R}from"../chunks/if.DRLG6bOh.js";import{a as Be,e as ue,i as Qe,r as Mt,s as Vt}from"../chunks/attributes.DPN48yOH.js";import{s as qt}from"../chunks/class.BN6JjLqI.js";import{t as pt,f as _t}from"../chunks/index.A-vRoXhT.js";import{b as ve}from"../chunks/input.Br29pWBN.js";import{b as pe}from"../chunks/select.CXmm0mL2.js";import{a as p}from"../chunks/preload-helper.B2IhT0O3.js";import{o as Kt}from"../chunks/index-client.Bib29rnf.js";import{a as C}from"../chunks/Icon.yFnM2WBm.js";import{g as Ot}from"../chunks/entry.Dq_-L3Yi.js";import{X as Bt}from"../chunks/x.xw5d-c1A.js";import{T as nt}from"../chunks/target.BDjRuX_8.js";import{S as Qt}from"../chunks/search.K0UJueoa.js";import{P as Ut}from"../chunks/plus.BfN9yc11.js";import{A as it}from"../chunks/arrow-up-down.0onLll3z.js";import{E as Wt}from"../chunks/eye.BPTSt0Sg.js";import{C as Xt}from"../chunks/check.BRje2wQJ.js";import{P as Ht}from"../chunks/pencil.BlEN5tg-.js";import{T as Jt}from"../chunks/trash-2.DnhmlcTU.js";var Rt=y("<option> </option>"),Zt=y('<div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"><div class="bg-card p-6 rounded-lg shadow-lg w-full max-w-md relative border border-border"><button class="absolute right-4 top-4 p-1 hover:bg-muted rounded-lg" title="Close"><!></button> <h2 class="text-xl font-semibold mb-4"> </h2> <form class="space-y-4"><div class="space-y-2"><label for="name" class="text-sm font-medium">Name</label> <textarea id="name" placeholder="Enter goal name" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring" required></textarea></div> <div class="space-y-2"><label for="description" class="text-sm font-medium">Description</label> <textarea id="description" placeholder="Enter description" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring" required></textarea></div> <div class="space-y-2"><label for="kpi" class="text-sm font-medium">KPI</label> <textarea id="kpi" placeholder="Enter KPI" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring" required></textarea></div> <div class="space-y-2"><label for="lead_id" class="text-sm font-medium">Lead</label> <select id="lead_id" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"><option>Select a lead</option><!></select></div> <div class="flex gap-2 pt-4"><button type="button" class="flex-1 px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80">Cancel</button> <button type="submit" class="flex-1 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"> </button></div></form></div></div>');function $t(w,i){var $,ee,te,ae;ct(i,!0);let S=u(p((($=i.goal)==null?void 0:$.name)||"")),_=u(p(((ee=i.goal)==null?void 0:ee.description)||"")),k=u(p(((te=i.goal)==null?void 0:te.kpi)||"")),z=u(p(((ae=i.goal)==null?void 0:ae.lead_id)||null));const G=v=>{v.preventDefault(),i.onSave({name:e(S),description:e(_),kpi:e(k),lead_id:e(z)})};var m=Zt(),F=r(m),N=r(F);N.__click=function(...v){var x;(x=i.onClose)==null||x.apply(this,v)};var Y=r(N);Bt(Y,{size:20}),a(N);var j=l(N,2),B=r(j);a(j);var q=l(j,2),K=r(q),O=l(r(K),2);Be(O),a(K);var E=l(K,2),D=l(r(E),2);Be(D),a(E);var T=l(E,2),I=l(r(T),2);Be(I),a(T);var Q=l(T,2),U=l(r(Q),2),W=r(U);W.value=(W.__value=null)==null?"":null;var _e=l(W);ue(_e,17,()=>i.leads,Qe,(v,x)=>{var P=Rt(),re={},ge=r(P,!0);a(P),A(()=>{re!==(re=e(x).id)&&(P.value=(P.__value=e(x).id)==null?"":e(x).id),f(ge,e(x).name)}),h(v,P)}),a(U),a(Q);var M=l(Q,2),Z=r(M);Z.__click=function(...v){var x;(x=i.onClose)==null||x.apply(this,v)};var X=l(Z,2),g=r(X);a(X),a(M),a(q),a(F),a(m),A(()=>{f(B,`${(i.goal?"Edit":"Create")??""} Strategic Goal`),X.disabled=i.isSaving,f(g,`${(i.isSaving?"Saving...":i.goal?"Update":"Create")??""} Goal`)}),Tt("submit",q,G),ve(O,()=>e(S),v=>n(S,v)),ve(D,()=>e(_),v=>n(_,v)),ve(I,()=>e(k),v=>n(k,v)),pe(U,()=>e(z),v=>n(z,v)),pt(3,m,()=>_t,()=>({duration:200})),h(w,m),dt()}vt(["click"]);var ea=y("<div><span> </span></div>"),ta=y("<option> </option>"),aa=y("<option> </option>"),ra=(w,i)=>n(i,!0),oa=y('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),sa=(w,i)=>i("goal_no"),la=(w,i)=>i("name"),na=(w,i)=>Ot(`/plans/${e(i).id}`),ia=y('<span class="inline-flex items-center gap-1 px-2.5 py-1 text-sm font-medium bg-gray-100 text-gray-700 rounded-lg" title="No Action Plans">N/A</span>'),ca=y('<span class="inline-flex items-center gap-1 px-2.5 py-1 text-sm font-medium bg-red-100 text-red-700 rounded-lg"><!> </span>'),da=y('<span class="inline-flex items-center gap-1 px-2.5 py-1 text-sm font-medium bg-green-100 text-green-700 rounded-lg" title="All Action Plans Approved"><!></span>'),ua=(w,i,S,_)=>{n(i,p(e(S))),n(_,!0)},va=(w,i,S)=>i(e(S).id),pa=y('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3 hidden md:table-cell"> </td><td class="px-4 py-3 hidden lg:table-cell"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><button class="inline-flex items-center gap-1.5 px-2.5 py-1.5 text-sm text-primary bg-primary/10 hover:bg-primary/20 rounded-md" title="View objectives"><!> View</button></td><td class="px-4 py-3 text-center"><!></td><td class="px-4 py-3"><div class="flex justify-center gap-2 items-center"><button class="hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground" title="Edit goal"><!></button> <button class="p-1.5 hover:bg-red-100 rounded-md transition-colors text-red-600" title="Delete goal"><!></button></div></td></tr>'),_a=(w,i)=>ut(i,-1),ga=(w,i)=>ut(i),fa=y('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Goal No <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Name <!></button></th><th class="px-4 py-3 text-left hidden md:table-cell">Description</th><th class="px-4 py-3 text-left hidden lg:table-cell">KPI</th><th class="px-4 py-3 text-left">Lead</th><th class="px-4 py-3 text-left">School Year</th><th class="px-4 py-3 text-left">Objectives</th><th class="px-4 py-3 text-center">Plan Status</th><th class="px-4 py-3 text-center">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring"><option>5 per page</option><option>10 per page</option><option>25 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Next</button></div></div></div>',1),ma=y('<div class="flex flex-col gap-4 p-4 container mx-auto"><!> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Strategic Goals</h1></div></div> <div class="flex flex-col md:flex-row gap-4 mb-2 items-center justify-between"><div class="flex flex-col md:flex-row gap-4 flex-1"><div class="relative flex-1 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search goals..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[200px]"><option>All Leads</option><!></select> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[200px]"><option>All School Years</option><!></select></div> <button class="flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors"><!> Add Goal</button></div> <!> <!></div>');function Va(w,i){ct(i,!0);let S=u(""),_=u(1),k=u(5),z=u(!1),G=u("goal_no"),m=u("asc"),F=u("all"),N=u("all"),Y=u(!0),j=u(null),B=u(!1),q=u(""),K=u("success"),O=u(!1),E=u(p([])),D=u(p([])),T=u(p([])),I=null;Kt(()=>{Q()});const Q=async()=>{await U(),await _e(),await W(),await M(),await Z(),n(Y,!1)},U=async()=>{const t=new Date().toISOString().split("T")[0],{data:o,error:s}=await C.from("school_years").select("id").lte("start_date",t).gte("end_date",t).maybeSingle();s?(console.error("Error fetching current school year:",s),I=null):(I=(o==null?void 0:o.id)||null,n(N,p(I||"all")))},W=async()=>{const{data:t,error:o}=await C.from("school_years").select("*").order("start_date",{ascending:!1});o?g("Error fetching school years","error"):n(T,p(t))},_e=async()=>{const{data:t,error:o}=await C.from("leads").select("id, name");o?g("Error fetching leads","error"):n(D,p(t))},M=async()=>{const{data:t,error:o}=await C.from("strategic_goals").select("*").order("goal_no",{ascending:e(m)==="asc"});o?g("Error fetching strategic goals","error"):n(E,p(t))},Z=async()=>{try{const{data:t,error:o}=await C.from("strategic_goals").select(`
					id,
					goal_no,
					name,
					description,
					kpi,
					lead_id,
					school_year,
					strategic_objectives (
						action_plans (
							is_approved
						)
					)
				`).order("goal_no",{ascending:!0});if(o){g("Error fetching strategic goals","error"),console.error("Error fetching strategic goals:",o);return}n(E,p(t.map(s=>{const d=(s.strategic_objectives||[]).flatMap(V=>V.action_plans||[]),se=d.filter(V=>V.is_approved===!1).length;return{...s,notApproved:se,hasActionPlans:d.length>0}})))}catch(t){console.error("Error processing not approved action plans data:",t)}},X=()=>e(E).length>0?Math.max(...e(E).map(t=>t.goal_no))+1:1,g=(t,o)=>{n(q,p(t)),n(K,p(o)),n(B,!0),setTimeout(()=>{n(B,!1)},3e3)},$=t=>{const o=e(D).find(s=>s.id===t);return o?o.name:"No Lead Assigned"},ee=t=>{const o=e(T).find(s=>s.id===t);return o?o.school_year:"No School Year"},te=async t=>{if(n(O,!0),!I){g("No current school year found. Cannot save goal.","error");return}const o={...t,school_year:I};if(e(j)){const{error:s}=await C.from("strategic_goals").update(o).match({id:e(j).id});s?g("Error updating goal","error"):(g("Goal updated successfully","success"),await M(),v())}else{const s={...o,goal_no:X()},{error:c}=await C.from("strategic_goals").insert([s]);c?g("Error creating goal","error"):(g("Goal created successfully","success"),await M(),v())}n(O,!1)},ae=async t=>{if(confirm("Are you sure you want to delete this goal?")){n(Y,!0);const{error:o}=await C.from("strategic_goals").delete().match({id:t});if(o){g("Error deleting goal","error"),n(Y,!1);return}const{data:s,error:c}=await C.from("strategic_goals").select("*").order("goal_no",{ascending:!0});if(c){g("Error reordering goals","error"),n(Y,!1);return}for(let d=0;d<s.length;(d+=1)-1)await C.from("strategic_goals").update({goal_no:d+1}).match({id:s[d].id});g("Goal deleted and reordered successfully","success"),await M(),n(Y,!1)}},v=()=>{n(z,!1),n(j,null)},x=t=>{e(G)===t?n(m,p(e(m)==="asc"?"desc":"asc")):(n(G,p(t)),n(m,"asc")),e(E).sort((o,s)=>{const c=o[t],d=s[t];return t==="goal_no"?e(m)==="asc"?Number(c)-Number(d):Number(d)-Number(c):e(m)==="asc"?String(c).localeCompare(String(d)):String(d).localeCompare(String(c))})},P=J(()=>e(E).filter(t=>{const s=`${t.name} ${t.description} ${t.kpi}`.toLowerCase().includes(e(S).toLowerCase()),c=e(F)==="all"||t.lead_id===e(F),d=e(N)==="all"||t.school_year===e(N);return s&&c&&d}).sort((t,o)=>{const s=t[e(G)],c=o[e(G)];return e(G)==="goal_no"?e(m)==="asc"?Number(s)-Number(c):Number(c)-Number(s):e(m)==="asc"?String(s).localeCompare(String(c)):String(c).localeCompare(String(s))})),re=J(()=>e(P).slice((e(_)-1)*e(k),e(_)*e(k))),ge=J(()=>Math.ceil(e(P).length/e(k)));var fe=ma(),Ue=r(fe);R(Ue,()=>e(B),t=>{var o=ea(),s=r(o),c=r(s,!0);a(s),a(o),A(()=>{qt(o,`flex items-center p-4 rounded-lg ${(e(K)==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800")??""}`),f(c,e(q))}),pt(3,o,()=>_t),h(t,o)});var me=l(Ue,2),We=r(me),gt=r(We);nt(gt,{class:"w-8 h-8 text-primary"}),de(2),a(We),a(me);var xe=l(me,2),be=r(xe),he=r(be),Xe=r(he);Qt(Xe,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var He=l(Xe,2);Mt(He),a(he);var oe=l(he,2),ye=r(oe);ye.value=(ye.__value="all")==null?"":"all";var ft=l(ye);ue(ft,17,()=>e(D),Qe,(t,o)=>{var s=ta(),c={},d=r(s,!0);a(s),A(()=>{c!==(c=e(o).id)&&(s.value=(s.__value=e(o).id)==null?"":e(o).id),f(d,e(o).name)}),h(t,s)}),a(oe);var we=l(oe,2),Se=r(we);Se.value=(Se.__value="all")==null?"":"all";var mt=l(Se);ue(mt,17,()=>e(T),Qe,(t,o)=>{var s=aa(),c={},d=r(s,!0);a(s),A(()=>{c!==(c=e(o).id)&&(s.value=(s.__value=e(o).id)==null?"":e(o).id),f(d,e(o).school_year)}),h(t,s)}),a(we),a(be);var ke=l(be,2);ke.__click=[ra,z];var xt=r(ke);Ut(xt,{size:20}),de(),a(ke),a(xe);var Je=l(xe,2);R(Je,()=>e(Y),t=>{var o=oa();h(t,o)},t=>{var o=fa(),s=lt(o),c=r(s),d=r(c),se=r(d),V=r(se),Ae=r(V);Ae.__click=[sa,x];var ht=l(r(Ae)),yt=J(()=>e(G)==="goal_no"?"text-primary":"");it(ht,{size:16,get class(){return e(yt)}}),a(Ae),a(V);var Re=l(V),Ne=r(Re);Ne.__click=[la,x];var wt=l(r(Ne)),St=J(()=>e(G)==="name"?"text-primary":"");it(wt,{size:16,get class(){return e(St)}}),a(Ne),a(Re),de(7),a(se),a(d);var Ze=l(d);ue(Ze,21,()=>e(re),H=>H.id,(H,b)=>{var je=pa(),ze=r(je),At=r(ze,!0);a(ze);var Ye=l(ze),Nt=r(Ye,!0);a(Ye);var Ie=l(Ye),Et=r(Ie,!0);a(Ie);var Le=l(Ie),Pt=r(Le,!0);a(Le);var Fe=l(Le),Ct=r(Fe,!0);A(()=>f(Ct,$(e(b).lead_id))),a(Fe);var De=l(Fe),Gt=r(De,!0);A(()=>f(Gt,ee(e(b).school_year))),a(De);var Te=l(De),Me=r(Te);Me.__click=[na,b];var jt=r(Me);Wt(jt,{size:16}),de(),a(Me),a(Te);var Ve=l(Te),zt=r(Ve);R(zt,()=>!e(b).hasActionPlans,Ke=>{var ie=ia();h(Ke,ie)},Ke=>{var ie=Dt(),Lt=lt(ie);R(Lt,()=>(e(b).notApproved??0)>0,Oe=>{var L=ca(),ce=r(L);nt(ce,{size:16});var Ft=l(ce);a(L),A(()=>{Vt(L,"title",`${e(b).notApproved??""} Action Plans Not Approved`),f(Ft,` ${e(b).notApproved??""}`)}),h(Oe,L)},Oe=>{var L=da(),ce=r(L);Xt(ce,{size:16}),a(L),h(Oe,L)},!0),h(Ke,ie)}),a(Ve);var ot=l(Ve),st=r(ot),ne=r(st);ne.__click=[ua,j,b,z];var Yt=r(ne);Ht(Yt,{size:18}),a(ne);var qe=l(ne,2);qe.__click=[va,ae,b];var It=r(qe);Jt(It,{size:18}),a(qe),a(st),a(ot),a(je),A(()=>{f(At,e(b).goal_no),f(Nt,e(b).name),f(Et,e(b).description),f(Pt,e(b).kpi)}),h(H,je)}),a(Ze),a(c),a(s);var $e=l(s,2),Ee=r($e),kt=r(Ee);A(()=>f(kt,`Showing ${(e(_)-1)*e(k)+1} to ${Math.min(e(_)*e(k),e(P).length)??""} of ${e(P).length??""} results`)),a(Ee);var et=l(Ee,2),le=r(et),Pe=r(le);Pe.value=(Pe.__value=5)==null?"":5;var Ce=l(Pe);Ce.value=(Ce.__value=10)==null?"":10;var tt=l(Ce);tt.value=(tt.__value=25)==null?"":25,a(le);var at=l(le,2),Ge=r(at);Ge.__click=[_a,_];var rt=l(Ge,2);rt.__click=[ga,_],a(at),a(et),a($e),A(()=>{Ge.disabled=e(_)===1,rt.disabled=e(_)===e(ge)}),pe(le,()=>e(k),H=>n(k,H)),h(t,o)});var bt=l(Je,2);R(bt,()=>e(z),t=>{$t(t,{get goal(){return e(j)},get leads(){return e(D)},get isSaving(){return e(O)},onSave:te,onClose:v})}),a(fe),ve(He,()=>e(S),t=>n(S,t)),pe(oe,()=>e(F),t=>n(F,t)),pe(we,()=>e(N),t=>n(N,t)),h(w,fe),dt()}vt(["click"]);export{Va as component};
