import{a as h,t as S,c as wt}from"../chunks/disclose-version.DTAQul2H.js";import{p as ze,t as H,a as Ie,s as a,c as r,r as t,d as f,b as c,g as e,f as We,n as W,e as ne}from"../chunks/runtime.B4QXH2CN.js";import{d as Fe,e as Xe,a as E,s as kt,b as St}from"../chunks/store.D_on7m4h.js";import{i as Q}from"../chunks/if.DRLG6bOh.js";import{a as C,e as Pt,r as jt,i as At,s as Et}from"../chunks/attributes.DPN48yOH.js";import{b as q}from"../chunks/input.Br29pWBN.js";import{b as qt}from"../chunks/select.CXmm0mL2.js";import{a as T}from"../chunks/preload-helper.B2IhT0O3.js";import{o as Dt}from"../chunks/index-client.Bib29rnf.js";import{a as V}from"../chunks/Icon.yFnM2WBm.js";import{p as Ot}from"../chunks/stores.BoiHb4t-.js";import{g as Ct}from"../chunks/entry.Dq_-L3Yi.js";import{E as Nt,a as zt}from"../chunks/jspdf.plugin.autotable.BvDXkAOZ.js";import{C as It}from"../chunks/chevron-left.WFET1Ekd.js";import{S as Ft}from"../chunks/search.K0UJueoa.js";import{D as Tt}from"../chunks/download.CXU6lRmm.js";import{P as Vt}from"../chunks/plus.BfN9yc11.js";import{A as Mt}from"../chunks/arrow-up-down.0onLll3z.js";import{E as Gt}from"../chunks/eye.BPTSt0Sg.js";import{T as Lt}from"../chunks/target.BDjRuX_8.js";import{C as Kt}from"../chunks/check.BRje2wQJ.js";import{P as $t}from"../chunks/pencil.BlEN5tg-.js";import{T as Ht}from"../chunks/trash-2.DnhmlcTU.js";var Yt=S('<form class="space-y-4"><h3 class="text-lg font-semibold">Edit Strategic Objective</h3> <div><label for="name" class="block text-sm font-medium mb-1">Strategic Objective</label> <textarea id="name" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required rows="3"></textarea></div> <div><label for="strategic_initiatives" class="block text-sm font-medium mb-1">Strategic Initiatives</label> <textarea id="strategic_initiatives" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required rows="3"></textarea></div> <div><label for="kpi" class="block text-sm font-medium mb-1">KPI</label> <textarea id="kpi" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required rows="3"></textarea></div> <div><label for="persons_involved" class="block text-sm font-medium mb-1">Persons Involved</label> <textarea id="persons_involved" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required rows="3"></textarea></div> <div><label for="target" class="block text-sm font-medium mb-1">Target</label> <textarea id="target" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required rows="3"></textarea></div> <div><label for="eval_measures" class="block text-sm font-medium mb-1">Evaluation Measures</label> <textarea id="eval_measures" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required rows="3"></textarea></div> <div class="flex justify-end gap-2 pt-4"><button type="button" class="px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/90">Cancel</button> <button type="submit" class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"> </button></div></form>');function Bt(P,o){ze(o,!0);let i=T({name:o.objective.name,strategic_initiatives:o.objective.strategic_initiatives,kpi:o.objective.kpi,persons_involved:o.objective.persons_involved,target:o.objective.target,eval_measures:o.objective.eval_measures});const M=n=>{n.preventDefault(),o.onSave(i)};var b=Yt(),_=a(r(b),2),l=a(r(_),2);C(l),t(_);var x=a(_,2),N=a(r(x),2);C(N),t(x);var p=a(x,2),v=a(r(p),2);C(v),t(p);var w=a(p,2),z=a(r(w),2);C(z),t(w);var u=a(w,2),m=a(r(u),2);C(m),t(u);var D=a(u,2),G=a(r(D),2);C(G),t(D);var L=a(D,2),K=r(L);K.__click=function(...n){var Y;(Y=o.onCancel)==null||Y.apply(this,n)};var O=a(K,2),U=r(O,!0);t(O),t(L),t(b),H(()=>{O.disabled=o.isSaving,E(U,o.isSaving?"Saving...":"Save")}),Xe("submit",b,M),q(l,()=>i.name,n=>i.name=n),q(N,()=>i.strategic_initiatives,n=>i.strategic_initiatives=n),q(v,()=>i.kpi,n=>i.kpi=n),q(z,()=>i.persons_involved,n=>i.persons_involved=n),q(m,()=>i.target,n=>i.target=n),q(G,()=>i.eval_measures,n=>i.eval_measures=n),h(P,b),Ie()}Fe(["click"]);var Qt=S('<form class="space-y-4"><h3 class="text-lg font-semibold">Add Strategic Objective</h3> <div><label for="name" class="block text-sm font-medium mb-1">Strategic Objective</label> <textarea id="name" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required rows="3"></textarea></div> <div><label for="strategic_initiatives" class="block text-sm font-medium mb-1">Strategic Initiatives</label> <textarea id="strategic_initiatives" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required rows="3"></textarea></div> <div><label for="kpi" class="block text-sm font-medium mb-1">KPI</label> <textarea id="kpi" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required rows="3"></textarea></div> <div><label for="persons_involved" class="block text-sm font-medium mb-1">Persons Involved</label> <textarea id="persons_involved" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required rows="3"></textarea></div> <div><label for="target" class="block text-sm font-medium mb-1">Target</label> <textarea id="target" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required rows="3"></textarea></div> <div><label for="eval_measures" class="block text-sm font-medium mb-1">Evaluation Measures</label> <textarea id="eval_measures" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required rows="3"></textarea></div> <div class="flex justify-end gap-2 pt-4"><button type="button" class="px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/90">Cancel</button> <button type="submit" class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"> </button></div></form>');function Jt(P,o){ze(o,!0);let i=T({name:"",strategic_initiatives:"",kpi:"",persons_involved:"",target:"",eval_measures:""});const M=n=>{n.preventDefault(),o.onSave(i)};var b=Qt(),_=a(r(b),2),l=a(r(_),2);C(l),t(_);var x=a(_,2),N=a(r(x),2);C(N),t(x);var p=a(x,2),v=a(r(p),2);C(v),t(p);var w=a(p,2),z=a(r(w),2);C(z),t(w);var u=a(w,2),m=a(r(u),2);C(m),t(u);var D=a(u,2),G=a(r(D),2);C(G),t(D);var L=a(D,2),K=r(L);K.__click=function(...n){var Y;(Y=o.onCancel)==null||Y.apply(this,n)};var O=a(K,2),U=r(O,!0);t(O),t(L),t(b),H(()=>{O.disabled=o.isSaving,E(U,o.isSaving?"Saving...":"Save")}),Xe("submit",b,M),q(l,()=>i.name,n=>i.name=n),q(N,()=>i.strategic_initiatives,n=>i.strategic_initiatives=n),q(v,()=>i.kpi,n=>i.kpi=n),q(z,()=>i.persons_involved,n=>i.persons_involved=n),q(m,()=>i.target,n=>i.target=n),q(G,()=>i.eval_measures,n=>i.eval_measures=n),h(P,b),Ie()}Fe(["click"]);const Rt=(P,o,i,M,b,_)=>{const l=new Nt("landscape","mm","a4");l.setFontSize(18),l.text("Strategic Objectives",14,20),e(o)&&(l.setFontSize(12),l.text(`Goal Name: ${e(o).name}`,14,30),l.text(`Lead: ${e(o).lead}`,14,37));const x=e(i).map(m=>[m.name,m.strategic_initiatives,m.kpi,m.persons_involved,m.target,m.eval_measures]);zt(l,{head:[["Strategic Objectives","Strategic Initiatives","KPI","Persons Involved","Target","Evaluation Measures"]],body:x,startY:58,theme:"grid",styles:{fontSize:10}});const v=l.internal.pageSize.height-30;l.setFontSize(12);const w=e(M)||"Admin Name",z=e(b)||"Vice President Name",u=e(_)||"President Name";l.text(`${w}(sgnd)`,14,v-5),l.text("_________________________",14,v),l.text("Corporate Planning Officer",14,v+5),l.text(`${z}`,100,v-5),l.text("_________________________",100,v),l.text("Vice President",100,v+5),l.text(`${u}`,180,v-5),l.text("_________________________",180,v),l.text("President",180,v+5),l.save("StrategicObjectives.pdf")};var Ut=S('<div class="flex justify-center items-center min-h-[200px]"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Wt=S('<div class="mt-2 text-muted-foreground"><p><span class="font-medium text-foreground">Goal Name:</span> </p> <p><span class="font-medium text-foreground">Lead:</span> </p></div>'),Xt=S('<div class="bg-card rounded-lg p-4 border border-border"><!></div>'),Zt=S('<div class="bg-card rounded-lg p-4 border border-border"><!></div>'),er=(P,o)=>c(o,!0),tr=(P,o)=>o("name"),rr=(P,o,i)=>o(e(i).id),ar=S('<span class="inline-flex items-center gap-1 px-2.5 py-1 text-sm font-medium bg-gray-100 text-gray-700 rounded-lg" title="No plans added">N/A</span>'),sr=S('<span class="inline-flex items-center gap-1 px-2.5 py-1 text-sm font-medium bg-red-100 text-red-700 rounded-lg"><!> </span>'),or=S('<span class="inline-flex items-center gap-1 px-2.5 py-1 text-sm font-medium bg-green-100 text-green-700 rounded-lg" title="All plans approved"><!></span>'),ir=(P,o,i)=>c(o,T(e(i))),nr=(P,o,i)=>o(e(i)),lr=S('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><button class="inline-flex items-center gap-1.5 px-2.5 py-1.5 text-sm text-primary bg-primary/10 hover:bg-primary/20 rounded-md" title="View plans"><!> View</button></td><td class="px-4 py-3 text-center"><!></td><td class="px-4 py-3"><div class="flex justify-center gap-2"><button class="hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground"><!></button> <button class="p-1.5 hover:bg-muted rounded-lg text-red-400 hover:text-red-500 disabled:opacity-50"><!></button></div></td></tr>'),dr=(P,o)=>c(o,e(o)-1),cr=(P,o)=>c(o,e(o)+1),vr=S('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Strategic Objectives <!></button></th><th class="px-4 py-3 text-left">Strategic Initiatives</th><th class="px-4 py-3 text-left">KPI</th><th class="px-4 py-3 text-left">Persons Involved</th><th class="px-4 py-3 text-left">Target</th><th class="px-4 py-3 text-left">Evaluation Measures</th><th class="px-4 py-3 text-left">Action Plans</th><th class="px-4 py-3 text-center w-[200px]">Plan Status</th><th class="px-4 py-3 text-center w-[200px]">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex gap-2 items-center"><select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div>',1),_r=S('<div class="text-center py-12 bg-card rounded-lg border border-border"><p class="text-muted-foreground mb-4">No objectives found for this goal.</p></div>'),ur=S('<div class="flex flex-col gap-6"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div><a href="/plans" class="flex items-center gap-2 text-muted-foreground mb-2 hover:text-foreground"><!> Back to Goals</a> <h1 class="text-2xl font-bold"> </h1> <!></div></div> <!> <!> <div class="flex flex-col md:flex-row justify-between items-center gap-4"><div class="relative flex-3 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search objectives..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <div class="flex gap-2"><button class="flex items-center gap-2 bg-secondary text-foreground px-4 py-2 rounded-lg hover:bg-secondary/80 justify-center whitespace-nowrap"><!> Export</button> <button class="flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90 justify-center whitespace-nowrap"><!> Add Objectives</button></div></div> <!></div>'),mr=S('<div class="container mx-auto p-4"><!></div>');function Vr(P,o){ze(o,!0);const i=kt(),M=()=>St(Ot,"$page",i);let b=f(""),_=f(1),l=f(5),x=f("name"),N=f("asc"),p=f(null),v=f(null),w=f(T([])),z=f(!0),u=f(null),m=f(!1),D=f(!1),G=f(null),L=f(null),K=f(null);const O=ne(()=>e(w).filter(s=>`${s.name} ${s.strategic_initiatives} ${s.kpi} ${s.persons_involved}`.toLowerCase().includes(e(b).toLowerCase())).sort((s,d)=>{const y=String(s[e(x)]),I=String(d[e(x)]);return e(N)==="asc"?y.localeCompare(I):I.localeCompare(y)})),U=ne(()=>e(O).slice((e(_)-1)*e(l),e(_)*e(l))),n=ne(()=>Math.ceil(e(O).length/e(l))),Y=s=>{e(x)===s?c(N,T(e(N)==="asc"?"desc":"asc")):(c(x,T(s)),c(N,"asc"))},Te=async s=>{c(D,!0);try{if(e(u)){const{error:d}=await V.from("strategic_objectives").update(s).eq("id",e(u).id);if(d)throw d}else{const{error:d}=await V.from("strategic_objectives").insert({...s,strategic_goal_id:e(p)});if(d)throw d}await le(),c(u,null),c(m,!1)}catch(d){console.error("Error saving objective:",d)}finally{c(D,!1)}},Ze=s=>{e(p)!==null&&Ct(`/plans/${e(p)}/${s}`)},et=async()=>{try{const{data:{session:s}}=await V.auth.getSession();if(!s||!s.user)return;const{data:d,error:y}=await V.from("profiles").select("first_name, last_name").eq("id",s.user.id).single();y?console.error("Error fetching admin name:",y):d&&c(G,`${d.first_name} ${d.last_name}`)}catch(s){console.error("Error fetching admin details:",s)}},tt=async()=>{try{const{data:s,error:d}=await V.from("profiles").select("first_name, last_name, role").in("role",["vice_president","president"]);if(d){console.error("Error fetching VP and President names:",d);return}const y=s==null?void 0:s.find(j=>j.role==="vice_president"),I=s==null?void 0:s.find(j=>j.role==="president");c(L,T(y?`${y.first_name} ${y.last_name}`:"N/A")),c(K,T(I?`${I.first_name} ${I.last_name}`:"N/A"))}catch(s){console.error("Error fetching VP and President details:",s)}},le=async()=>{if(e(p)!==null){c(z,!0);try{const{data:s,error:d}=await V.from("strategic_goals").select("id, name, goal_no, lead_id").eq("id",e(p)).single();if(d||!s)throw new Error("Failed to fetch goal details");if(c(v,T({id:s.id,name:s.name,goal_no:s.goal_no,lead:""})),s.lead_id){const{data:j,error:B}=await V.from("leads").select("name").eq("id",s.lead_id).single();B?console.error("Error fetching lead name:",B):j&&(e(v).lead=j.name)}const{data:y,error:I}=await V.from("strategic_objectives").select(`
					id,
					name,
					strategic_initiatives,
					kpi,
					persons_involved,
					target,
					eval_measures,
					action_plans (
						is_approved
					)
				`).eq("strategic_goal_id",e(p));if(I)throw new Error("Failed to fetch objectives");c(w,T((y||[]).map(j=>{const B=j.action_plans||[],J=B.filter(ve=>ve.is_approved===!1).length,X=B.length>0;return{...j,notApproved:J,hasActionPlans:X,allApproved:X&&J===0}})))}catch(s){console.error(s)}finally{c(z,!1)}}};let de=f(!1);const rt=async s=>{if(confirm("Are you sure you want to delete this objective?")){c(de,!0);try{const{error:d}=await V.from("strategic_objectives").delete().eq("id",s.id);if(d)throw d;await le(),alert("Objective deleted successfully")}catch(d){console.error("Error deleting objective:",d),alert("Failed to delete objective")}finally{c(de,!1)}}};Dt(()=>{c(p,T(M().params.id?parseInt(M().params.id):null)),le(),et(),tt()});var ce=mr(),at=r(ce);Q(at,()=>e(z),s=>{var d=Ut();h(s,d)},s=>{var d=ur(),y=r(d),I=r(y),j=r(I),B=r(j);It(B,{size:20}),W(),t(j);var J=a(j,2),X=r(J);t(J);var ve=a(J,2);Q(ve,()=>e(v),k=>{var g=Wt(),F=r(g),ee=a(r(F));t(F);var R=a(F,2),te=a(r(R));t(R),t(g),H(()=>{E(ee,` ${e(v).name??""}`),E(te,` ${e(v).lead??""}`)}),h(k,g)}),t(I),t(y);var Ve=a(y,2);Q(Ve,()=>e(m),k=>{var g=Xt(),F=r(g);Jt(F,{get isSaving(){return e(D)},onSave:Te,onCancel:()=>c(m,!1)}),t(g),h(k,g)});var Me=a(Ve,2);Q(Me,()=>e(u),k=>{var g=Zt(),F=r(g);Bt(F,{get objective(){return e(u)},get isSaving(){return e(D)},onSave:Te,onCancel:()=>c(u,null)}),t(g),h(k,g)});var _e=a(Me,2),ue=r(_e),Ge=r(ue);Ft(Ge,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var Le=a(Ge,2);jt(Le),t(ue);var Ke=a(ue,2),Z=r(Ke);Z.__click=[Rt,v,w,G,L,K];var st=r(Z);Tt(st,{size:20}),W(),t(Z);var me=a(Z,2);me.__click=[er,m];var ot=r(me);Vt(ot,{size:20}),W(),t(me),t(Ke),t(_e);var it=a(_e,2);Q(it,()=>e(w).length>0,k=>{var g=vr(),F=We(g),ee=r(F),R=r(ee),te=r(R),$e=r(te),pe=r($e);pe.__click=[tr,Y];var nt=a(r(pe)),lt=ne(()=>e(x)==="name"?"text-primary":"");Mt(nt,{size:16,get class(){return e(lt)}}),t(pe),t($e),W(8),t(te),t(R);var He=a(R);Pt(He,21,()=>e(U),At,(he,A)=>{var we=lr(),ke=r(we),ct=r(ke,!0);t(ke);var Se=a(ke),vt=r(Se,!0);t(Se);var Pe=a(Se),_t=r(Pe,!0);t(Pe);var je=a(Pe),ut=r(je,!0);t(je);var Ae=a(je),mt=r(Ae,!0);t(Ae);var Ee=a(Ae),pt=r(Ee,!0);t(Ee);var qe=a(Ee),De=r(qe);De.__click=[rr,Ze,A];var gt=r(De);Gt(gt,{size:18}),W(),t(De),t(qe);var Oe=a(qe),ft=r(Oe);Q(ft,()=>!e(A).hasActionPlans,Ce=>{var oe=ar();h(Ce,oe)},Ce=>{var oe=wt(),yt=We(oe);Q(yt,()=>e(A).notApproved>0,Ne=>{var $=sr(),ie=r($);Lt(ie,{size:16});var ht=a(ie);t($),H(()=>{Et($,"title",`${e(A).notApproved??""} plans not approved`),E(ht,` ${e(A).notApproved??""}`)}),h(Ne,$)},Ne=>{var $=or(),ie=r($);Kt(ie,{size:16}),t($),h(Ne,$)},!0),h(Ce,oe)}),t(Oe);var Re=a(Oe),Ue=r(Re),ae=r(Ue);ae.__click=[ir,u,A];var bt=r(ae);$t(bt,{size:18}),t(ae);var se=a(ae,2);se.__click=[nr,rt,A];var xt=r(se);Ht(xt,{size:18}),t(se),t(Ue),t(Re),t(we),H(()=>{E(ct,e(A).name),E(vt,e(A).strategic_initiatives),E(_t,e(A).kpi),E(ut,e(A).persons_involved),E(mt,e(A).target),E(pt,e(A).eval_measures),se.disabled=e(de)}),h(he,we)}),t(He),t(ee),t(F);var Ye=a(F,2),ge=r(Ye),dt=r(ge);H(()=>E(dt,`Showing ${(e(_)-1)*e(l)+1} to ${Math.min(e(_)*e(l),e(O).length)??""} of ${e(O).length??""} results`)),t(ge);var Be=a(ge,2),re=r(Be),fe=r(re);fe.value=(fe.__value=5)==null?"":5;var be=a(fe);be.value=(be.__value=10)==null?"":10;var xe=a(be);xe.value=(xe.__value=25)==null?"":25;var Qe=a(xe);Qe.value=(Qe.__value=50)==null?"":50,t(re);var ye=a(re,2);ye.__click=[dr,_];var Je=a(ye,2);Je.__click=[cr,_],t(Be),t(Ye),H(()=>{ye.disabled=e(_)===1,Je.disabled=e(_)===e(n)}),qt(re,()=>e(l),he=>c(l,he)),h(k,g)},k=>{var g=_r();h(k,g)}),t(d),H(()=>{var k;return E(X,`Strategic Objectives for Goal ${((k=e(v))==null?void 0:k.goal_no)??""}`)}),q(Le,()=>e(b),k=>c(b,k)),h(s,d)}),t(ce),h(P,ce),Ie()}Fe(["click"]);export{Vr as component};
