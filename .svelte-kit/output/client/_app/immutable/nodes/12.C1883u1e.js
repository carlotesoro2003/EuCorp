import{a as C,t as M,c as Xe}from"../chunks/disclose-version.DTAQul2H.js";import{p as ne,c as a,r,s as o,t as Q,a as se,d as D,g as e,f as pe,b as l,e as ee,n as ge,m as te,P as kt}from"../chunks/runtime.B4QXH2CN.js";import{i as X}from"../chunks/if.DRLG6bOh.js";import{i as Re}from"../chunks/lifecycle.DAFDPKuL.js";import{a as H,p as ie}from"../chunks/preload-helper.B2IhT0O3.js";import{a as R}from"../chunks/Icon.yFnM2WBm.js";import{d as ue,a as Y,e as Et}from"../chunks/store.D_on7m4h.js";import{a as J,r as Te,e as De,i as $e}from"../chunks/attributes.DPN48yOH.js";import{s as Je}from"../chunks/class.BN6JjLqI.js";import{b as W}from"../chunks/input.Br29pWBN.js";import{b as Ze}from"../chunks/select.CXmm0mL2.js";import{P as At}from"../chunks/pencil.BlEN5tg-.js";import{T as et}from"../chunks/trash-2.DnhmlcTU.js";import{E as Ot,a as St}from"../chunks/jspdf.plugin.autotable.BvDXkAOZ.js";import{L as Pt}from"../chunks/lightbulb.BQf6SH5D.js";import{A as le}from"../chunks/arrow-up-down.0onLll3z.js";import{S as Nt}from"../chunks/search.K0UJueoa.js";import{D as Ft}from"../chunks/download.CXU6lRmm.js";import{X as It}from"../chunks/x.xw5d-c1A.js";import{o as zt}from"../chunks/index-client.Bib29rnf.js";import{S as Dt}from"../chunks/save.DYSOdrWi.js";import{P as Rt}from"../chunks/plus.BfN9yc11.js";var Tt=(g,t)=>t.onApprove(t.opportunity.id),Ct=(g,t)=>t.onEdit(t.opportunity),jt=(g,t)=>t.onDelete(t.opportunity.id),Ut=M('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><div class="flex items-center gap-2"><button class="px-2 py-1 text-sm rounded bg-green-500 text-white hover:bg-green-600 disabled:opacity-50"> </button> <button class="hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground"><!></button> <button class="p-1 rounded hover:bg-muted text-red-500 hover:text-red-600 disabled:opacity-50"><!></button></div></td></tr>');function Mt(g,t){ne(t,!0);var i=Ut(),_=a(i),b=a(_,!0);r(_);var A=o(_),u=a(A,!0);r(A);var v=o(A),y=a(v,!0);r(v);var E=o(v),x=a(E,!0);r(E);var O=o(E),w=a(O,!0);r(O);var I=o(O),j=a(I);Q(()=>Y(j,`P${t.opportunity.budget.toFixed(2)??""}`)),r(I);var z=o(I),N=a(z,!0);r(z);var V=o(z),U=a(V),T=a(U);T.__click=[Tt,t];var c=a(T,!0);r(T);var d=o(T,2);d.__click=[Ct,t];var f=a(d);At(f,{size:16}),r(d);var k=o(d,2);k.__click=[jt,t];var F=a(k);et(F,{size:16}),r(k),r(U),r(V),r(i),Q(()=>{Y(b,t.opportunity.opt_statement),Y(u,t.opportunity.planned_actions),Y(y,t.opportunity.kpi),Y(x,t.opportunity.key_persons),Y(w,t.opportunity.target_output),Y(N,t.opportunity.department_name),T.disabled=t.approvingId===t.opportunity.id||t.userRole==="admin"&&t.opportunity.is_approved||t.userRole==="vice_president"&&(!t.opportunity.is_approved||t.opportunity.is_approved_vp)||t.userRole==="president"&&(!t.opportunity.is_approved_vp||t.opportunity.is_approved_president),Y(c,t.approvingId===t.opportunity.id?"Processing...":t.userRole==="admin"?t.opportunity.is_approved?"Admin Approved":"Approve":t.userRole==="vice_president"?t.opportunity.is_approved_vp?"VP Approved":"Approve":t.userRole==="president"&&t.opportunity.is_approved_president?"President Approved":"Approve"),k.disabled=t.deletingId===t.opportunity.id}),C(g,i),se()}ue(["click"]);var qt=M('<form class="h-full max-h-screen flex flex-col gap-4 p-4"><h3 class="text-lg font-semibold">Edit Opportunity</h3> <div class="flex-1 overflow-y-auto pr-2"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="space-y-4"><div class="space-y-2"><label for="opt_statement">Statement</label> <textarea id="opt_statement" class="w-full p-2 border rounded-lg bg-background min-h-[100px] overflow-hidden"></textarea></div> <div class="space-y-2"><label for="planned_actions">Planned Actions</label> <textarea id="planned_actions" class="w-full p-2 border rounded-lg bg-background min-h-[100px] overflow-hidden"></textarea></div></div> <div class="space-y-4"><div class="space-y-2"><label for="kpi">KPI</label> <textarea id="kpi" class="w-full p-2 border rounded-lg bg-background min-h-[42px] overflow-hidden"></textarea></div> <div class="space-y-2"><label for="key_persons">Key Persons</label> <textarea id="key_persons" class="w-full p-2 border rounded-lg bg-background min-h-[42px] overflow-hidden"></textarea></div> <div class="space-y-2"><label for="target_output">Target Output</label> <textarea id="target_output" class="w-full p-2 border rounded-lg bg-background min-h-[42px] overflow-hidden"></textarea></div> <div class="space-y-2"><label for="budget">Budget</label> <input type="number" id="budget" class="w-full p-2 border rounded-lg bg-background" min="0" step="0.01"></div></div></div></div> <div class="sticky bottom-0 flex justify-end gap-2 pt-4 border-t bg-background"><button type="submit" class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"> </button></div></form>');function Kt(g,t){ne(t,!0);let i=t.opportunity?{...t.opportunity}:{opt_statement:"",planned_actions:"",kpi:"",key_persons:"",target_output:"",budget:0};const _=S=>{S.preventDefault(),t.onSave(i)},b=S=>{const L=S.target;L.style.height="auto",L.style.height=L.scrollHeight+"px"};var A=qt(),u=o(a(A),2),v=a(u),y=a(v),E=a(y),x=o(a(E),2);J(x),x.__input=b,r(E);var O=o(E,2),w=o(a(O),2);J(w),w.__input=b,r(O),r(y);var I=o(y,2),j=a(I),z=o(a(j),2);J(z),z.__input=b,r(j);var N=o(j,2),V=o(a(N),2);J(V),V.__input=b,r(N);var U=o(N,2),T=o(a(U),2);J(T),T.__input=b,r(U);var c=o(U,2),d=o(a(c),2);Te(d),r(c),r(I),r(v),r(u);var f=o(u,2),k=a(f),F=a(k,!0);r(k),r(f),r(A),Q(()=>{k.disabled=t.saving,Y(F,t.saving?"Saving...":"Save Changes")}),Et("submit",A,_),W(x,()=>i.opt_statement,S=>i.opt_statement=S),W(w,()=>i.planned_actions,S=>i.planned_actions=S),W(z,()=>i.kpi,S=>i.kpi=S),W(V,()=>i.key_persons,S=>i.key_persons=S),W(T,()=>i.target_output,S=>i.target_output=S),W(d,()=>i.budget,S=>i.budget=S),C(g,A),se()}ue(["input"]);const Vt=(g,t,i,_,b,A)=>{const u=new Ot("landscape");u.setFont("times","normal"),u.setFontSize(12),u.text("MANUEL S. ENVERGA UNIVERSITY FOUNDATION",14,10),u.text("Opportunities Report",14,16),u.setFontSize(10),u.text("SY 2024-2025",14,22);const v=["Opportunity Statement","Planned Actions","KPI","Key Persons","Target Output","Budget","Department"],y=e(t).map(N=>[N.opt_statement,N.planned_actions,N.kpi,N.key_persons,N.target_output,N.budget.toFixed(2),N.department_name||"Unknown"]);St(u,{head:[v],body:y,startY:28,theme:"grid",styles:{font:"times",fontSize:10},headStyles:{fillColor:[41,128,185]}});const x=u.internal.pageSize.height-40,O=u.internal.pageSize.width/4,w=[14,O,O*2,O*3];u.setFontSize(10);const I=e(i)[0],j=(I==null?void 0:I.user_name)||"Unknown",z=(I==null?void 0:I.department_name)||"Unknown";u.text(`${j} (sgnd)`,w[0],x-5),u.text("_________________________",w[0],x),u.text(`${z} Department Head`,w[0],x+5),u.text(`${e(_)||"N/A"} (sgnd)`,w[1],x-5),u.text("_________________________",w[1],x),u.text("Corporate Planning Officer",w[1],x+5),u.text(`${e(b)||"N/A"} (sgnd)`,w[2],x-5),u.text("_________________________",w[2],x),u.text("Vice President",w[2],x+5),u.text(`${e(A)||"N/A"} (sgnd)`,w[3],x-5),u.text("_________________________",w[3],x),u.text("President",w[3],x+5),u.save("Opportunities_Report.pdf")};var Lt=M("<div><span> </span></div>"),Bt=(g,t)=>l(t,!e(t)),Ht=M("<option> </option>"),Yt=M('<button class="flex items-center gap-2 bg-secondary px-4 py-2 rounded-lg hover:bg-secondary/80 flex-1 md:flex-initial"><!> Export</button> <button class="flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50"></button>',1),Gt=M('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Qt=(g,t)=>t("opt_statement"),Wt=(g,t)=>t("planned_actions"),Xt=(g,t)=>t("budget"),Jt=(g,t)=>t("department_name"),Zt=(g,t)=>l(t,e(t)-1),$t=(g,t)=>l(t,e(t)+1),er=M('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Statement <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Actions <!></button></th><th class="px-4 py-3 text-left">KPI</th><th class="px-4 py-3 text-left">Key Persons</th><th class="px-4 py-3 text-left">Target</th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Budget <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Department <!></button></th><th class="px-4 py-3 text-left w-[150px]">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 w-full sm:w-auto"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>',1),tr=M('<div class="fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto"><div class="bg-card p-3 rounded-lg w-full max-w-md relative border border-border"><button class="absolute right-4 top-4 p-1 hover:bg-muted rounded-lg"><!></button> <!></div></div>'),rr=M('<div class="flex flex-col gap-4 container mx-auto p-6"><!> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Opportunities Management</h1></div></div> <button class="md:hidden w-full px-4 py-2 bg-secondary rounded-lg text-left flex justify-between items-center">Filters <!></button> <div><div class="flex flex-col md:flex-row gap-4 w-full md:w-auto"><div class="relative flex-1 md:w-[300px]"><!> <input type="text" placeholder="Search opportunities..." class="pl-10 pr-4 py-2 bg-secondary border-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary rounded-lg px-3 py-2 w-full md:w-[200px]"><option>All Departments</option><!></select></div> <div class="flex gap-2 w-full md:w-auto"><!></div></div> <!> <!></div>');function ar(g,t){ne(t,!0);let i=D(""),_=D(1),b=D(5),A=D(!1),u=D(null),v=D("opt_statement"),y=D("asc"),E=D("all"),x=D(!1),O=D(!1),w=D(""),I=D("success"),j=D(!1),z=D(!0),N=D(null),V=D(null),U=!1,T=D(H([])),c=D(H([])),d=D(null),f=D(null),k=D(null),F=D(null);const S=async()=>{await L(),await re(),await G(),await oe(),await ae(),l(z,!1)},L=async()=>{const{data:{session:n}}=await R.auth.getSession();if(!n||!n.user)return;const{data:s,error:p}=await R.from("profiles").select("role").eq("id",n.user.id).single();if(p){m("Error fetching user role: "+p.message,"error");return}l(d,H(s.role))},re=async()=>{const{data:n,error:s}=await R.from("profiles").select("first_name, last_name").eq("role","admin");if(s){m("Error fetching admin name: "+s.message,"error"),l(f,"N/A");return}l(f,H(n.map(p=>`${p.first_name} ${p.last_name}`).join(", ")))},ae=async()=>{const{data:n,error:s}=await R.from("profiles").select("first_name, last_name, role").in("role",["vice_president","president"]);if(s){m("Error fetching VP and President names: "+s.message,"error"),l(k,"N/A"),l(F,"N/A");return}const p=n.find(P=>P.role==="vice_president"),h=n.find(P=>P.role==="president");l(k,H(p?`${p.first_name} ${p.last_name}`:"N/A")),l(F,H(h?`${h.first_name} ${h.last_name}`:"N/A"))},G=async()=>{const{data:n,error:s}=await R.from("opportunities").select(`
                *,
                profiles (
                    first_name,
                    last_name,
                    departments (name)
                )
            `);if(s){m("Error fetching opportunities: "+s.message,"error");return}l(T,H(n.map(p=>{var h,P,q,Z;return{...p,department_name:((P=(h=p.profiles)==null?void 0:h.departments)==null?void 0:P.name)||"N/A",user_name:`${((q=p.profiles)==null?void 0:q.first_name)||""} ${((Z=p.profiles)==null?void 0:Z.last_name)||""}`}})))},oe=async()=>{const{data:n,error:s}=await R.from("departments").select("id, name");if(s){m("Error fetching departments: "+s.message,"error");return}l(c,H(n))},m=(n,s)=>{l(w,H(n)),l(I,H(s)),l(O,!0),setTimeout(()=>{l(O,!1)},3e3)},B=ee(()=>e(T).filter(n=>{const p=`${n.opt_statement} ${n.planned_actions} ${n.department_name}`.toLowerCase().includes(e(i).toLowerCase()),h=e(E)==="all"||n.department_name===e(E);return p&&h}).sort((n,s)=>{const p=String(n[e(v)]),h=String(s[e(v)]);return e(y)==="asc"?p.localeCompare(h):h.localeCompare(p)})),$=ee(()=>e(B).slice((e(_)-1)*e(b),e(_)*e(b))),tt=ee(()=>Math.ceil(e(B).length/e(b))),ce=n=>{e(v)===n?l(y,H(e(y)==="asc"?"desc":"asc")):(l(v,H(n)),l(y,"asc"))},rt=async n=>{l(V,H(n));const{error:s}=await R.from("opportunities").delete().eq("id",n);s?m("Error deleting opportunity: "+s.message,"error"):(await G(),m("Opportunity deleted successfully!","success")),l(V,null)},at=async n=>{l(N,H(n));let s={};e(d)==="admin"?s={is_approved:!0}:e(d)==="vice_president"?s={is_approved_vp:!0}:e(d)==="president"&&(s={is_approved_president:!0});const{data:p,error:h}=await R.from("opportunities").update(s).eq("id",n).select();if(h)m("Error approving opportunity: "+h.message,"error");else{if(e(d)==="president"&&p&&p.length>0){const P=p[0],{error:q}=await R.from("opt_monitoring").insert({opt_id:P.id,profile_id:P.profile_id,department_id:P.department_id});q&&m("Error adding to monitoring: "+q.message,"error")}await G(),m("Opportunity approved successfully!","success")}l(N,null)},ot=async n=>{if(!e(u))return;l(j,!0);const{error:s}=await R.from("opportunities").update({opt_statement:n.opt_statement,planned_actions:n.planned_actions,kpi:n.kpi,key_persons:n.key_persons,target_output:n.target_output,budget:n.budget}).eq("id",e(u).id);s?m("Error updating opportunity: "+s.message,"error"):(await G(),m("Opportunity updated successfully!","success"),Ce()),l(j,!1)},Ce=()=>{l(A,!1),l(u,null)},it=async()=>{U=!0;let n={};if(e(d)==="admin")n={is_approved:!0};else if(e(d)==="vice_president")n={is_approved_vp:!0};else if(e(d)==="president")n={is_approved_president:!0};else{U=!1;return}try{const{error:s}=await R.from("opportunities").update(n).in("id",e($).map(p=>p.id));if(s)m("Error approving opportunities: "+s.message,"error");else{if(e(d)==="president"){const p=e($).map(K=>K.id),{data:h,error:P}=await R.from("opt_monitoring").select("opt_id").in("opt_id",p);if(P){m("Error fetching existing monitoring entries: "+P.message,"error");return}const q=h.map(K=>K.opt_id),Z=e($).filter(K=>!q.includes(K.id)).map(K=>({opt_id:K.id,profile_id:K.profile_id,department_id:K.department_id}));if(Z.length>0){const{error:K}=await R.from("opt_monitoring").insert(Z);K&&m("Error adding new monitoring entries: "+K.message,"error")}}await G(),m("All displayed opportunities approved successfully!","success")}}catch(s){console.error("Unexpected error approving all opportunities:",s),m("An unexpected error occurred.","error")}finally{U=!1}};S();var fe=rr(),je=a(fe);X(je,()=>e(O),n=>{var s=Lt(),p=a(s),h=a(p,!0);r(p),r(s),Q(()=>{Je(s,`alert alert-${e(I)??""} shadow-lg mb-4`),Y(h,e(w))}),C(n,s)});var be=o(je,2),Ue=a(be),nt=a(Ue);Pt(nt,{class:"w-8 h-8 text-primary"}),ge(2),r(Ue),r(be);var _e=o(be,2);_e.__click=[Bt,x];var st=o(a(_e)),dt=ee(()=>e(x)?"rotate-180":"");le(st,{size:16,get class(){return e(dt)}}),r(_e);var ve=o(_e,2),xe=a(ve),ye=a(xe),Me=a(ye);Nt(Me,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var qe=o(Me,2);Te(qe),r(ye);var he=o(ye,2),we=a(he);we.value=(we.__value="all")==null?"":"all";var lt=o(we);De(lt,17,()=>e(c),$e,(n,s)=>{var p=Ht(),h={},P=a(p,!0);r(p),Q(()=>{h!==(h=e(s).name)&&(p.value=(p.__value=e(s).name)==null?"":e(s).name),Y(P,e(s).name)}),C(n,p)}),r(he),r(xe);var Ke=o(xe,2),pt=a(Ke);X(pt,()=>e($).length>0,n=>{var s=Yt(),p=pe(s);p.__click=[Vt,B,T,f,k,F];var h=a(p);Ft(h,{size:20}),ge(),r(p);var P=o(p,2);P.__click=it,Q(()=>P.disabled=U||e($).every(q=>e(d)==="admin"&&q.is_approved||e(d)==="vice_president"&&q.is_approved_vp||e(d)==="president"&&q.is_approved_president)),P.textContent=U?"Processing...":"Approve All",C(n,s)}),r(Ke),r(ve);var Ve=o(ve,2);X(Ve,()=>e(z),n=>{var s=Gt();C(n,s)},n=>{var s=er(),p=pe(s),h=a(p),P=a(h),q=a(P),Z=a(q),K=a(Z);K.__click=[Qt,ce];var ct=o(a(K)),_t=ee(()=>e(v)==="opt_statement"?"text-primary":"");le(ct,{size:16,get class(){return e(_t)}}),r(K),r(Z);var ke=o(Z),Ee=a(ke);Ee.__click=[Wt,ce];var vt=o(a(Ee)),mt=ee(()=>e(v)==="planned_actions"?"text-primary":"");le(vt,{size:16,get class(){return e(mt)}}),r(Ee),r(ke);var Ae=o(ke,4),Oe=a(Ae);Oe.__click=[Xt,ce];var gt=o(a(Oe)),ft=ee(()=>e(v)==="budget"?"text-primary":"");le(gt,{size:16,get class(){return e(ft)}}),r(Oe),r(Ae);var Le=o(Ae),Se=a(Le);Se.__click=[Jt,ce];var bt=o(a(Se)),xt=ee(()=>e(v)==="department_name"?"text-primary":"");le(bt,{size:16,get class(){return e(xt)}}),r(Se),r(Le),ge(),r(q),r(P);var Be=o(P);De(Be,21,()=>e($),de=>de.id,(de,ht)=>{Mt(de,{get opportunity(){return e(ht)},get userRole(){return e(d)},onEdit:wt=>{l(u,H(wt)),l(A,!0)},onDelete:rt,onApprove:at,get approvingId(){return e(N)},get deletingId(){return e(V)}})}),r(Be),r(h),r(p);var He=o(p,2),Pe=a(He),yt=a(Pe);Q(()=>Y(yt,`Showing ${(e(_)-1)*e(b)+1} to ${Math.min(e(_)*e(b),e(B).length)??""} of ${e(B).length??""} results`)),r(Pe);var Ye=o(Pe,2),me=a(Ye),Ne=a(me);Ne.value=(Ne.__value=5)==null?"":5;var Fe=o(Ne);Fe.value=(Fe.__value=10)==null?"":10;var Ie=o(Fe);Ie.value=(Ie.__value=25)==null?"":25;var Ge=o(Ie);Ge.value=(Ge.__value=50)==null?"":50,r(me);var Qe=o(me,2),ze=a(Qe);ze.__click=[Zt,_];var We=o(ze,2);We.__click=[$t,_],r(Qe),r(Ye),r(He),Q(()=>{ze.disabled=e(_)===1,We.disabled=e(_)===e(tt)}),Ze(me,()=>e(b),de=>l(b,de)),C(n,s)});var ut=o(Ve,2);X(ut,()=>e(A),n=>{var s=tr(),p=a(s),h=a(p);h.__click=Ce;var P=a(h);It(P,{size:20}),r(h);var q=o(h,2);Kt(q,{get opportunity(){return e(u)},onSave:ot,get saving(){return e(j)}}),r(p),r(s),C(n,s)}),r(fe),Q(()=>Je(ve,`flex flex-col gap-4 ${e(x)?"block":"hidden"} md:flex md:flex-row md:justify-between`)),W(qe,()=>e(i),n=>l(i,n)),Ze(he,()=>e(E),n=>l(E,n)),C(g,fe),se()}ue(["click"]);const or=(g,t,i,_)=>{t()(i()),l(_,!1)};var ir=M('<button class="text-green-500 hover:text-green-700 transition-colors p-2" title="Save edits"><!></button>'),nr=(g,t)=>t("opt_statement",g.target.value),sr=(g,t)=>t("planned_actions",g.target.value),dr=(g,t)=>t("kpi",g.target.value),lr=(g,t)=>t("key_persons",g.target.value),pr=(g,t)=>t("target_output",g.target.value),ur=(g,t)=>t("budget",+g.target.value),cr=M('<div class="bg-card rounded-lg p-4 border border-border hover:shadow-lg transition-shadow"><div class="space-y-4"><div class="flex justify-between items-center"><h3 class="text-lg font-medium truncate"> </h3> <div class="flex gap-2"><!> <button class="p-2 hover:bg-red-100 text-red-500 hover:text-red-600 rounded-lg" title="Delete opportunity"><!></button></div></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-muted-foreground mb-1">Opportunity Statement</label> <textarea class="w-full rounded-lg bg-background border border-border p-2 focus:ring-2 focus:ring-primary/50"></textarea></div> <div><label class="block text-sm font-medium text-muted-foreground mb-1">Planned Actions</label> <textarea class="w-full rounded-lg bg-background border border-border p-2 focus:ring-2 focus:ring-primary/50"></textarea></div> <div><label class="block text-sm font-medium text-muted-foreground mb-1">KPI</label> <textarea class="w-full rounded-lg bg-background border border-border p-2 focus:ring-2 focus:ring-primary/50"></textarea></div> <div><label class="block text-sm font-medium text-muted-foreground mb-1">Key Persons</label> <textarea class="w-full rounded-lg bg-background border border-border p-2 focus:ring-2 focus:ring-primary/50"></textarea></div> <div><label class="block text-sm font-medium text-muted-foreground mb-1">Target Output</label> <textarea class="w-full rounded-lg bg-background border border-border p-2 focus:ring-2 focus:ring-primary/50"></textarea></div> <div><label class="block text-sm font-medium text-muted-foreground mb-1">Budget</label> <input type="number" class="w-full rounded-lg bg-background border border-border p-2 focus:ring-2 focus:ring-primary/50"></div></div></div></div>');function _r(g,t){ne(t,!1);let i=ie(t,"data",12),_=ie(t,"onSave",8,()=>{}),b=ie(t,"onEdit",8,()=>{}),A=ie(t,"onDelete",8,()=>{}),u=ie(t,"opportunityNumber",8),v=te(!1);const y=(m,B)=>{l(v,!0),b()(m,B)};Re();var E=cr(),x=a(E),O=a(x),w=a(O),I=a(w);r(w);var j=o(w,2),z=a(j);X(z,()=>e(v),m=>{var B=ir();B.__click=[or,_,i,v];var $=a(B);Dt($,{class:"w-5 h-5"}),r(B),C(m,B)});var N=o(z,2);N.__click=[function(...m){var B;(B=A())==null||B.apply(this,m)}];var V=a(N);et(V,{size:18}),r(N),r(j),r(O);var U=o(O,2),T=a(U),c=o(a(T),2);J(c),c.__input=[nr,y],r(T);var d=o(T,2),f=o(a(d),2);J(f),f.__input=[sr,y],r(d);var k=o(d,2),F=o(a(k),2);J(F),F.__input=[dr,y],r(k);var S=o(k,2),L=o(a(S),2);J(L),L.__input=[lr,y],r(S);var re=o(S,2),ae=o(a(re),2);J(ae),ae.__input=[pr,y],r(re);var G=o(re,2),oe=o(a(G),2);Te(oe),oe.__input=[ur,y],r(G),r(U),r(x),r(E),Q(()=>Y(I,`Opportunity ${u()??""}`)),W(c,()=>i().opt_statement,m=>i(i().opt_statement=m,!0)),W(f,()=>i().planned_actions,m=>i(i().planned_actions=m,!0)),W(F,()=>i().kpi,m=>i(i().kpi=m,!0)),W(L,()=>i().key_persons,m=>i(i().key_persons=m,!0)),W(ae,()=>i().target_output,m=>i(i().target_output=m,!0)),W(oe,()=>i().budget,m=>i(i().budget=m,!0)),C(g,E),se()}ue(["click","input"]);const vr=async(g,t,i,_,b)=>{l(t,!0);try{const u=e(i).filter(v=>v.isNew||v.isEdited).map(({isNew:v,isEdited:y,...E})=>E);if(u.length>0){const{error:v}=await R.from("opportunities").upsert(u,{onConflict:"id"});if(v)throw v;await _(),b("Opportunities saved successfully!","success")}else b("No changes to save.","success")}catch(A){console.error("Error saving opportunities:",A),b("Failed to save opportunities.","error")}finally{l(t,!1)}};var mr=M('<div class="p-4 rounded-lg bg-green-100 text-green-800"> </div>'),gr=M('<div class="p-4 rounded-lg bg-red-100 text-red-800"> </div>'),fr=M('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),br=M('<div class="grid grid-cols-1 gap-6 mb-6"></div> <div class="flex justify-end gap-4"><button class="flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors"><!> Add Opportunity</button> <button class="flex items-center gap-2 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors disabled:opacity-50">Save All</button></div>',1),xr=M('<div class="flex flex-col gap-4 p-4 container mx-auto"><!> <!> <div class="bg-card rounded-lg shadow border border-border p-6"><h2 class="text-xl font-semibold mb-4">Opportunities</h2> <!></div></div>');function yr(g,t){ne(t,!1);let i=te([]),_=null,b=te(!1),A=te(!1),u=te(null),v=te(null);const y=(c,d)=>{l(u,d==="success"?c:null),l(v,d==="error"?c:null),setTimeout(()=>{l(u,null),l(v,null)},3e3)},E=async()=>{var c,d;try{const{data:f,error:k}=await R.auth.getSession();if(k)throw k;const F=(d=(c=f==null?void 0:f.session)==null?void 0:c.user)==null?void 0:d.id;if(!F)throw new Error("No logged-in user found.");const{data:S,error:L}=await R.from("profiles").select("id, department_id").eq("id",F).single();if(L)throw L;_=S}catch(f){console.error("Error fetching user profile:",f),y("Failed to fetch profile details.","error")}},x=async()=>{l(b,!0);try{const{data:c,error:d}=await R.from("opportunities").select("*").eq("department_id",_==null?void 0:_.department_id).order("id",{ascending:!0});if(d)throw d;l(i,c||[])}catch(c){console.error("Error fetching opportunities:",c),y("Error fetching opportunities.","error")}finally{l(b,!1)}},O=()=>{if(!(_!=null&&_.id)||!_.department_id){y("Missing profile or department information.","error");return}l(i,[...e(i),{opt_statement:"",planned_actions:"",kpi:"",key_persons:"",target_output:"",budget:0,profile_id:_.id,department_id:_.department_id,isNew:!0}])},w=async c=>{const d=e(i)[c];if(d.isNew){l(i,e(i).filter((f,k)=>k!==c));return}try{const{error:f}=await R.from("opportunities").delete().eq("id",d.id);if(f)throw f;l(i,e(i).filter((k,F)=>F!==c)),y("Opportunity deleted successfully.","success")}catch(f){console.error("Error deleting opportunity:",f),y("Failed to delete opportunity.","error")}},I=(c,d,f)=>{kt(i,e(i)[c]={...e(i)[c],[d]:f,isEdited:!0})},j=async c=>{try{const{isEdited:d,isNew:f,...k}=e(i)[c],{error:F}=await R.from("opportunities").upsert(k,{onConflict:"id"});if(F)throw F;await x(),y("Opportunity saved successfully.","success")}catch(d){console.error("Error saving opportunity:",d),y("Failed to save opportunity.","error")}};zt(async()=>{await E(),await x()}),Re();var z=xr(),N=a(z);X(N,()=>e(u),c=>{var d=mr(),f=a(d,!0);r(d),Q(()=>Y(f,e(u))),C(c,d)});var V=o(N,2);X(V,()=>e(v),c=>{var d=gr(),f=a(d,!0);r(d),Q(()=>Y(f,e(v))),C(c,d)});var U=o(V,2),T=o(a(U),2);X(T,()=>e(b),c=>{var d=fr();C(c,d)},c=>{var d=br(),f=pe(d);De(f,5,()=>e(i),$e,(re,ae,G)=>{_r(re,{get data(){return e(ae)},opportunityNumber:G+1,onEdit:(oe,m)=>I(G,oe,m),onSave:()=>j(G),onDelete:()=>w(G)})}),r(f);var k=o(f,2),F=a(k);F.__click=O;var S=a(F);Rt(S,{class:"w-4 h-4 mr-2"}),ge(),r(F);var L=o(F,2);L.__click=[vr,A,i,x,y],r(k),Q(()=>L.disabled=e(A)),C(c,d)}),r(U),r(z),C(g,z),se()}ue(["click"]);var hr=M("<div><!></div>");function Br(g,t){ne(t,!1);let i=ie(t,"data",8);const{session:_}=i();let b=te(null),A=te(!0);(async()=>{if(_){const{user:E}=_,{data:x,error:O}=await R.from("profiles").select("role").eq("id",E.id).single();O?console.error("Error fetching user profile:",O.message):(l(b,x),console.log("Role in Opportunities: ",e(b)))}l(A,!1)})(),Re();var v=hr(),y=a(v);X(y,()=>e(A),E=>{},E=>{var x=Xe(),O=pe(x);X(O,()=>_!==null&&e(b),w=>{var I=Xe(),j=pe(I);X(j,()=>e(b).role==="admin"||e(b).role=="vice_president"||e(b).role=="president",z=>{ar(z,{})},z=>{yr(z,{})}),C(w,I)},null,!0),C(E,x)}),r(v),C(g,v),se()}export{Br as component};
