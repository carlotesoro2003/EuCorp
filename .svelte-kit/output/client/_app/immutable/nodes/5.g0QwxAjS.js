import{a as w,t as k,c as te}from"../chunks/disclose-version.DTAQul2H.js";import{p as O,b as A,a as L,m as M,c as o,r as a,s as y,n as ge,t as z,g as e,f as W,P as Z,O as ae,d as U,F as fe}from"../chunks/runtime.B4QXH2CN.js";import{i as T}from"../chunks/if.DRLG6bOh.js";import{i as B}from"../chunks/lifecycle.DAFDPKuL.js";import{a as G,p as me}from"../chunks/preload-helper.B2IhT0O3.js";/* empty css                         */import"../chunks/entry.Dq_-L3Yi.js";import{a as F}from"../chunks/Icon.yFnM2WBm.js";import{a as N,e as re}from"../chunks/store.D_on7m4h.js";import{e as ie,i as se}from"../chunks/attributes.DPN48yOH.js";import{o as H}from"../chunks/index-client.Bib29rnf.js";import{b as Q}from"../chunks/this.DKypJMlz.js";import{C as X,a as pe}from"../chunks/auto.BeoUz-Qp.js";import{b as he}from"../chunks/select.CXmm0mL2.js";import{L as be}from"../chunks/loader-circle.C4FWx07d.js";import{t as J,f as oe,a as _e}from"../chunks/index.A-vRoXhT.js";const S={cards:[{title:"Strategic Goals",value:"0",change:12.5,icon:"ðŸŽ¯"},{title:"Unmitigated Risks",value:"0",change:-2.4,icon:"âš ï¸"},{title:"Opportunities",value:"0",change:8.2,icon:"ðŸ’¡"},{title:"Users",value:"0",change:5.1,icon:"ðŸ‘¥"}],barChart:{goals:["Strategic Goal 1","Strategic Goal 2","Strategic Goal 3","Strategic Goal 4","Strategic Goal 5"],achieved:[75,60,85,45,65],notAchieved:[25,40,15,55,35]},riskData:{categories:["Manpower","Financial","Technical","Operational"],datasets:{manpower:[30,50,20],financial:[45,35,20],technical:[25,45,30],operational:[35,40,25]}},opportunitiesData:{achieved:0,notAchieved:0,total:0,labels:["Achieved","Not Achieved"]},recentEvents:[{title:"New project milestone achieved",time:"2 hours ago",type:"success"},{title:"System maintenance scheduled",time:"5 hours ago",type:"warning"},{title:"Server capacity reached 90%",time:"8 hours ago",type:"error"},{title:"New team member onboarded",time:"1 day ago",type:"success"}]},xe=async()=>{try{const{data:l,error:u}=await F.from("strategic_goals").select("id");if(u)throw u;const r=l.length;S.cards[0].value=`${r}`}catch(l){console.error("Error updating strategic goals count:",l),S.cards[0].value="0 Goals"}},ye=async()=>{try{const{data:l,error:u}=await F.from("risk_monitoring").select("id",{count:"exact"}).eq("is_achieved",!1);if(u)throw u;const r=l.length;S.cards[1].value=`${r}`}catch(l){console.error("Error updating unmitigated risks count:",l),S.cards[1].value="0 Risks"}},we=async()=>{try{const{data:l,error:u}=await F.from("opportunities").select("id");if(u)throw u;const r=l.length;S.cards[2].value=`${r}`}catch(l){console.error("Error updating opportunities count:",l),S.cards[2].value="0 Opportunities"}},ke=async()=>{try{const{data:l,error:u}=await F.from("profiles").select("id");if(u)throw u;const r=l.length;S.cards[3].value=`${r}`}catch(l){console.error("Error updating users count:",l),S.cards[3].value="0 Users"}};var Ce=k('<div class="group relative overflow-hidden bg-card rounded-lg border border-border p-4 hover:shadow-lg transition-all duration-300 hover:-translate-y-1"><div class="flex items-center justify-between"><div><p class="text-sm font-medium text-gray-500 dark:text-gray-300"> </p> <p class="mt-2 text-3xl font-bold "> </p></div> <div class="rounded-xl bg-blue-50 p-4 text-2xl text-blue-600 transition-transform duration-300 group-hover:rotate-12"> </div></div> <div class="mt-4"></div></div>'),Ae=k('<div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"></div>');function ne(l,u){O(u,!1);let r=M(S.cards);H(async()=>{await xe(),await ye(),await we(),await ke(),A(r,[...S.cards])}),B();var s=Ae();ie(s,5,()=>e(r),se,(t,d)=>{var v=Ce(),f=o(v),b=o(f),x=o(b),c=o(x,!0);a(x);var m=y(x,2),n=o(m,!0);a(m),a(b);var i=y(b,2),p=o(i,!0);a(i),a(f),ge(2),a(v),z(()=>{N(c,e(d).title),N(n,e(d).value),N(p,e(d).icon)}),w(t,v)}),a(s),w(l,s),L()}var Se=k('<div class="relative h-[400px] w-full bg-card"><canvas></canvas></div> <div class="flex justify-center mt-4 space-x-4"><button class="flex items-center gap-2 bg-secondary text-foreground hover:bg-gray-200 px-4 py-2 rounded-lg hover:bg-secondary/80 justify-center flex-1 md:flex-initial">Previous</button> <button class="flex items-center gap-2 bg-secondary text-foreground hover:bg-gray-200 px-4 py-2 rounded-lg hover:bg-secondary/80 justify-center flex-1 md:flex-initial">Next</button></div>',1);function le(l,u){O(u,!1);let r=M(),s,t=M({goals:[],achieved:[],notAchieved:[]}),d=M(0),v=M(9),f={goals:[],achieved:[],notAchieved:[]};const b=()=>{const h=window.innerWidth;A(v,h<640?2:9),c()},x=async()=>{try{const{data:h,error:P}=await F.from("strategic_goals").select(`
					id,
					goal_no,
					name,
					strategic_objectives (
						id,
						name,
						action_plans (
							id,
							plan_monitoring (
								id,
								is_accomplished
							)
						)
					)
				`);if(P){console.error("Error fetching strategic goals:",P);return}const Y=h.sort((R,q)=>R.goal_no-q.goal_no).map(R=>{const q=R.strategic_objectives.flatMap(V=>V.action_plans.flatMap(I=>I.plan_monitoring.filter(K=>K.is_accomplished))).length,ue=R.strategic_objectives.flatMap(V=>V.action_plans.flatMap(I=>I.plan_monitoring.filter(K=>!K.is_accomplished))).length;return{goal_no:R.goal_no,name:R.name,achieved:q,notAchieved:ue}});Z(t,e(t).goals=Y.map(R=>`Strategic Goal No. ${R.goal_no}`)),Z(t,e(t).achieved=Y.map(R=>R.achieved)),Z(t,e(t).notAchieved=Y.map(R=>R.notAchieved)),b()}catch(h){console.error("Error processing strategic data:",h)}},c=()=>{const h=e(d)*e(v),P=h+e(v);f.goals=e(t).goals.slice(h,P),f.achieved=e(t).achieved.slice(h,P),f.notAchieved=e(t).notAchieved.slice(h,P),m()},m=()=>{const h=e(r).getContext("2d");h&&(s&&s.destroy(),s=new X(h,{type:"bar",data:{labels:f.goals,datasets:[{label:"Achieved",data:f.achieved,backgroundColor:"#e21d48",borderColor:"#e21d48",borderWidth:1},{label:"Not Achieved",data:f.notAchieved,backgroundColor:"#e5e7eb",borderColor:"#e5e7eb",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},scales:{x:{stacked:!0,ticks:{autoSkip:!1}},y:{stacked:!0,beginAtZero:!0}}}}))},n=()=>{(e(d)+1)*e(v)<e(t).goals.length&&(ae(d),c())},i=()=>{e(d)>0&&(ae(d,-1),c())};let p;const g=()=>{clearTimeout(p),p=setTimeout(()=>{b()},250)};H(()=>((async()=>{await x()})(),window.addEventListener("resize",g),()=>{window.removeEventListener("resize",g),s&&s.destroy()})),B();var _=Se(),C=W(_),$=o(C);Q($,h=>A(r,h),()=>e(r)),a(C);var j=y(C,2),D=o(j),E=y(D,2);a(j),z(()=>{D.disabled=e(d)===0,E.disabled=(e(d)+1)*e(v)>=e(t).goals.length}),re("click",D,i),re("click",E,n),w(l,_),L()}var De=k('<div class="flex justify-center p-8 "><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Re=k("<option> </option>"),$e=k('<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6"><p class="font-medium text-md">Classification:</p> <div class="relative w-full sm:w-1/3 lg:w-1/4"><select class="appearance-none bg-secondary border-secondary rounded-lg px-4 py-2 pr-10 text-sm font-medium focus:outline-none transition-colors focus:ring-2 focus:ring-ring w-full md:w-[150px]"></select> <!></div></div> <div class="h-[300px]"><canvas></canvas></div>',1),Ee=k('<div class="w-full rounded-lg border bg-card border-border p-4 hover:shadow-lg transition-all duration-300"><h2 class="mb-6 text-xl font-semibold">Risks Analysis</h2> <!></div>');function de(l,u){O(u,!0);let r=U(G([])),s=U(""),t=U(G({})),d=U(!0),v,f=null;const b=async()=>{try{const{data:n,error:i}=await F.from("classification").select("name");if(i)throw i;A(r,G(n.map(_=>_.name))),A(t,G(e(r).reduce((_,C)=>(_[C]={low:0,medium:0,high:0,very_high:0},_),{})));const{data:p,error:g}=await F.from("risk_monitoring").select(`
					control_rating_id ( name ),
					risks ( classification ( name ) )
				`);if(g)throw g;p.forEach(_=>{var j,D,E;const C=((D=(j=_.risks)==null?void 0:j.classification)==null?void 0:D.name)||"Unknown",$=(E=_.control_rating_id)==null?void 0:E.name.toLowerCase().replace(" ","_");if(e(t)[C]&&$){const h=$==="very_high"?"very_high":$;e(t)[C][h]!==void 0&&(e(t)[C][h]+=1)}}),e(r).length>0&&(A(s,G(e(r)[0])),setTimeout(()=>{x()},0))}catch(n){console.error("Error fetching risk data:",n)}finally{A(d,!1)}},x=()=>{if(!v)return;const n=v.getContext("2d");if(!n)return;f&&f.destroy();const i=e(t)[e(s)]||{low:0,medium:0,high:0,very_high:0};i.low,i.medium,i.high,i.very_high,f=new X(n,{type:"doughnut",data:{labels:["Low Risk","Medium Risk","High Risk","Very High Risk"],datasets:[{data:[i.low,i.medium,i.high,i.very_high],backgroundColor:["#34C759","#FFCC00","#FF9500","#FF3B30"],borderWidth:2,borderColor:"#ffffff"}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"65%",plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0}}}}})};fe(()=>{e(s)&&!e(d)&&x()}),H(()=>{b()});var c=Ee(),m=y(o(c),2);T(m,()=>e(d),n=>{var i=De();w(n,i)},n=>{var i=$e(),p=W(i),g=y(o(p),2),_=o(g);ie(_,21,()=>e(r),se,(D,E)=>{var h=Re(),P={},ee=o(h,!0);a(h),z(()=>{P!==(P=e(E))&&(h.value=(h.__value=e(E))==null?"":e(E)),N(ee,e(E))}),w(D,h)}),a(_);var C=y(_,2);pe(C,{class:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-500 pointer-events-none"}),a(g),a(p);var $=y(p,2),j=o($);Q(j,D=>v=D,()=>v),a($),he(_,()=>e(s),D=>A(s,D)),w(n,i)}),a(c),w(l,c),L()}var Fe=k('<div class="flex justify-center p-8"><!></div>'),je=k('<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6"><p class="font-medium text-md"> </p></div> <div class="h-[300px]"><canvas></canvas></div>',1),Pe=k('<div class="w-full rounded-lg border bg-card border-border p-4 hover:shadow-lg transition-all duration-300"><h2 class="mb-6 text-xl font-semibold">Opportunities Status</h2> <!></div>');function ce(l,u){O(u,!0);let r=U(G({achieved:0,notAchieved:0,total:0})),s=U(!0),t,d=null;const v=async()=>{try{const{data:c,error:m}=await F.from("opt_monitoring").select("is_accomplished");if(m)throw m;const n=c.filter(p=>p.is_accomplished).length,i=c.length;A(r,G({achieved:n,notAchieved:i-n,total:i})),setTimeout(()=>{f()},0)}catch(c){console.error("Error fetching opportunities:",c)}finally{A(s,!1)}},f=()=>{if(!t)return;const c=t.getContext("2d");c&&(d&&d.destroy(),d=new X(c,{type:"doughnut",data:{labels:["Achieved","Not Achieved"],datasets:[{data:[e(r).achieved,e(r).notAchieved],backgroundColor:["#34C759","#FF3B30"],borderWidth:2,borderColor:"#ffffff"}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"65%",plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0}}}}}))};H(()=>{v()});var b=Pe(),x=y(o(b),2);T(x,()=>e(s),c=>{var m=Fe(),n=o(m);be(n,{class:"h-8 w-8 animate-spin"}),a(m),w(c,m)},c=>{var m=je(),n=W(m),i=o(n),p=o(i);a(i),a(n);var g=y(n,2),_=o(g);Q(_,C=>t=C,()=>t),a(g),z(()=>N(p,`Total Opportunities: ${e(r).total??""}`)),w(c,m)}),a(b),w(l,b),L()}var Ge=k('<span class="ml-1 animate-pulse text-muted-foreground/50">Loading...</span>'),Ue=k('<span class="ml-1 rounded-full bg-secondary px-2 py-0.5 text-foreground"> </span>'),Oe=k('<div class="flex flex-col"><header class="overflow-x-auto bg-card rounded-lg  border border-border p-6"><div class="flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between"><div><h1 class="text-3xl font-bold text-foreground">Welcome Back</h1> <p class="mt-2 text-sm font-medium text-muted-foreground"></p> <div class="mt-1 flex items-center gap-2"><p class="text-sm font-medium text-muted-foreground">School Year: <!></p></div></div></div></header></div>');function ve(l,u){O(u,!0);const r=new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});let s=U(null),t=U(!0);async function d(){try{const p=new Date().toISOString().split("T")[0],{data:g,error:_}=await F.from("school_years").select("school_year").lte("start_date",p).gte("end_date",p).single();_?(console.error("Error fetching school year:",_),A(s,"Unknown")):A(s,G((g==null?void 0:g.school_year)||"Unknown"))}catch(p){console.error("Unexpected error fetching school year:",p),A(s,"Unknown")}finally{A(t,!1)}}d();var v=Oe(),f=o(v),b=o(f),x=o(b),c=y(o(x),2);c.textContent=r;var m=y(c,2),n=o(m),i=y(o(n));T(i,()=>e(t),p=>{var g=Ge();J(1,g,()=>oe),w(p,g)},p=>{var g=Ue(),_=o(g,!0);a(g),z(()=>N(_,e(s))),J(1,g,()=>oe),w(p,g)}),a(n),a(m),a(x),a(b),a(f),a(v),J(1,x,()=>_e,()=>({y:20,duration:700})),w(l,v),L()}var Le=k('<main class=" min-h-screen  p-4 md:p-6 container mx-auto "><div class="mx-auto max-w-7xl space-y-8"><!> <!> <div class="rounded-lg border bg-card border-border p-4 hover:shadow-lg transition-all duration-300 "><h2 class="mb-6 text-xl font-semibold ">Strategic Goal Overview</h2> <!></div> <div class="grid gap-8 lg:grid-cols-2"><!> <!></div></div></main>');function Me(l,u){O(u,!1),B();var r=Le(),s=o(r),t=o(s);ve(t,{});var d=y(t,2);ne(d,{get data(){return S.cards}});var v=y(d,2),f=y(o(v),2);le(f,{get data(){return S.barChart}}),a(v);var b=y(v,2),x=o(b);de(x,{get data(){return S.riskData}});var c=y(x,2);ce(c,{}),a(b),a(s),a(r),w(l,r),L()}var Te=k('<main class=" min-h-screen  p-4 md:p-6 container mx-auto "><div class="mx-auto max-w-7xl space-y-8"><!> <!> <div class="rounded-lg border border-border p-4 hover:shadow-lg transition-all duration-300 "><h2 class="mb-6 text-xl font-semibold">Strategic Goal Overiew</h2> <!></div> <div class="grid gap-8 lg:grid-cols-2"><!> <!></div></div></main>');function Ne(l,u){O(u,!1),B();var r=Te(),s=o(r),t=o(s);ve(t,{});var d=y(t,2);ne(d,{get data(){return S.cards}});var v=y(d,2),f=y(o(v),2);le(f,{get data(){return S.barChart}}),a(v);var b=y(v,2),x=o(b);de(x,{get data(){return S.riskData}});var c=y(x,2);ce(c,{}),a(b),a(s),a(r),w(l,r),L()}var We=k('<div class="flex flex-col items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),ze=k('<div class="w-full"><!></div>'),Be=k('<div class="min-h-screen "><div class="flex flex-col items-center justify-center w-full h-full"><div class="w-full "><!></div></div></div>');function st(l,u){O(u,!1);let r=me(u,"data",8);const{session:s}=r();let t=M(null),d=M(!0);(async()=>{if(s){const{user:m}=s,{data:n,error:i}=await F.from("profiles").select("first_name, last_name, role, profile_pic").eq("id",m.id).single();i?console.error("Error fetching user profile:",i.message):A(t,n)}A(d,!1)})(),B();var f=Be(),b=o(f),x=o(b),c=o(x);T(c,()=>e(d),m=>{var n=We();w(m,n)},m=>{var n=te(),i=W(n);T(i,()=>s!==null&&e(t),p=>{var g=ze(),_=o(g);T(_,()=>e(t).role==="admin"||e(t).role==="vice_president"||e(t).role==="president",C=>{Me(C,{})},C=>{var $=te(),j=W($);T(j,()=>e(t).role==="user",D=>{Ne(D,{})},null,!0),w(C,$)}),a(g),w(p,g)},null,!0),w(m,n)}),a(x),a(b),a(f),w(l,f),L()}export{st as component};
