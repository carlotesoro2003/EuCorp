import{c as ue,a as _,t as $,b as ta}from"./disclose-version.DTAQul2H.js";import{f as St,p as we,F as Fe,g as t,a as ke,d as s,b as i,c as a,r as e,t as O,O as Se,e as _t,s as r,n as Ct}from"./runtime.B4QXH2CN.js";import{I as Ae,s as Ne,a as wt}from"./Icon.yFnM2WBm.js";import{l as Ce,s as Ee,a as y}from"./preload-helper.B2IhT0O3.js";import{d as Pe,a as g}from"./store.D_on7m4h.js";import{i as rt}from"./if.DRLG6bOh.js";import{e as ee,r as Me,i as se,a as ea}from"./attributes.DPN48yOH.js";import{s as fe}from"./class.BN6JjLqI.js";import{t as he,f as $e,s as We}from"./index.A-vRoXhT.js";import{b as ye}from"./input.Br29pWBN.js";import{b as ie}from"./select.CXmm0mL2.js";import{b as ba}from"./this.DKypJMlz.js";import{o as Te}from"./index-client.Bib29rnf.js";import{C as xa,a as Re}from"./auto.BeoUz-Qp.js";import{E as Ie,a as aa}from"./jspdf.plugin.autotable.BvDXkAOZ.js";import{S as Le}from"./search.K0UJueoa.js";import{D as ra}from"./download.CXU6lRmm.js";import{L as ze}from"./loader-circle.C4FWx07d.js";import{T as oa}from"./triangle-alert.BSZOOXW1.js";import{A as be}from"./arrow-up-down.0onLll3z.js";import{L as ia}from"./lightbulb.BQf6SH5D.js";import{E as sa}from"./eye.BPTSt0Sg.js";import{X as De}from"./x.xw5d-c1A.js";import{c as ha}from"./riskCalculator.D3oLOKg6.js";import{P as ya}from"./pencil.BlEN5tg-.js";function wa(m,o){const v=Ce(o,["children","$$slots","$$events","$$legacy"]);Ae(m,Ee({name:"building-2"},()=>v,{iconNode:[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"}],["path",{d:"M10 6h4"}],["path",{d:"M10 10h4"}],["path",{d:"M10 14h4"}],["path",{d:"M10 18h4"}]],children:(n,w)=>{var l=ue(),x=St(l);Ne(x,o,"default",{}),_(n,l)},$$slots:{default:!0}}))}function la(m,o){const v=Ce(o,["children","$$slots","$$events","$$legacy"]);Ae(m,Ee({name:"circle-check-big"},()=>v,{iconNode:[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335"}],["path",{d:"m9 11 3 3L22 4"}]],children:(n,w)=>{var l=ue(),x=St(l);Ne(x,o,"default",{}),_(n,l)},$$slots:{default:!0}}))}function Qe(m,o){const v=Ce(o,["children","$$slots","$$events","$$legacy"]);Ae(m,Ee({name:"circle-x"},()=>v,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m15 9-6 6"}],["path",{d:"m9 9 6 6"}]],children:(n,w)=>{var l=ue(),x=St(l);Ne(x,o,"default",{}),_(n,l)},$$slots:{default:!0}}))}function na(m,o){const v=Ce(o,["children","$$slots","$$events","$$legacy"]);Ae(m,Ee({name:"file-text"},()=>v,{iconNode:[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M10 9H8"}],["path",{d:"M16 13H8"}],["path",{d:"M16 17H8"}]],children:(n,w)=>{var l=ue(),x=St(l);Ne(x,o,"default",{}),_(n,l)},$$slots:{default:!0}}))}function si(m,o){const v=Ce(o,["children","$$slots","$$events","$$legacy"]);Ae(m,Ee({name:"monitor"},()=>v,{iconNode:[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21"}]],children:(n,w)=>{var l=ue(),x=St(l);Ne(x,o,"default",{}),_(n,l)},$$slots:{default:!0}}))}function da(m,o){const v=Ce(o,["children","$$slots","$$events","$$legacy"]);Ae(m,Ee({name:"notepad-text"},()=>v,{iconNode:[["path",{d:"M8 2v4"}],["path",{d:"M12 2v4"}],["path",{d:"M16 2v4"}],["rect",{width:"16",height:"18",x:"4",y:"4",rx:"2"}],["path",{d:"M8 10h6"}],["path",{d:"M8 14h8"}],["path",{d:"M8 18h5"}]],children:(n,w)=>{var l=ue(),x=St(l);Ne(x,o,"default",{}),_(n,l)},$$slots:{default:!0}}))}var ka=$('<div class="h-[200px] min-h-[200px] w-full"><canvas></canvas></div>');function $a(m,o){we(o,!0);let v=s(null),u=s(void 0);const n=()=>{if(!t(u))return;const x=t(u).getContext("2d");x&&(t(v)&&t(v).destroy(),i(v,y(new xa(x,{type:"doughnut",data:{labels:["Achieved","Not Achieved"],datasets:[{data:[o.chartData.achieved,o.chartData.notAchieved],backgroundColor:["rgb(34, 197, 94)","rgb(239, 68, 68)"],borderWidth:1,borderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:document.documentElement.classList.contains("dark")?"#fff":"#000",padding:10,font:{size:12}}}}}}))))};Fe(()=>{t(v)&&o.chartData&&(t(v).data.datasets[0].data=[o.chartData.achieved,o.chartData.notAchieved],t(v).update())}),Te(()=>(n(),()=>{t(v)&&t(v).destroy()}));var w=ka(),l=a(w);ba(l,x=>i(u,x),()=>t(u)),e(w),_(m,w),ke()}const Sa=(m,o,v,u)=>{const n=new Ie("landscape");try{n.setFontSize(16),n.text("MANUEL S. ENVERGA UNIVERSITY FOUNDATION",n.internal.pageSize.width/2,15,{align:"center"}),n.setFontSize(12),n.text("Plan Monitoring Report",n.internal.pageSize.width/2,22,{align:"center"}),n.text("SY 2024-2025",n.internal.pageSize.width/2,28,{align:"center"}),n.setFontSize(11);const w=t(o).length,l=t(v).achieved,x=t(v).notAchieved,E=(l/w*100).toFixed(1);n.text([`Total Plans: ${w}`,`Achieved: ${l}`,`Not Achieved: ${x}`,`Achievement Rate: ${E}%`],14,40);const Q=["Department","Actions Taken","KPI","Evaluation","Statement","Status","Time Completed"],et=t(o).map(Y=>[Y.department,Y.actions_taken,Y.kpi,Y.evaluation||"Pending",Y.statement||"Pending",Y.is_accomplished?"Achieved":"Not Achieved",Y.time_completed?new Date(Y.time_completed).toLocaleString():"N/A"]);aa(n,{head:[Q],body:et,startY:60,theme:"grid",styles:{fontSize:8},headStyles:{fillColor:[41,128,185]}}),n.save("PlanMonitoring.pdf"),u("PDF exported successfully","success")}catch{u("Error exporting PDF","error")}},Aa=async(m,o,v,u)=>{i(o,!0);try{const n=await fetch("/api/summary-report-plan-monitoring",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plans:t(v)})}),w=await n.json();if(!n.ok||w.error)throw new Error(w.error||"Failed to generate summary.");const l=new Ie;l.setFont("times","normal"),l.setFontSize(12),l.text("MANUEL S. ENVERGA UNIVERSITY FOUNDATION",14,10),l.setFontSize(10),l.text("SY 2024-2025",14,20),l.setFontSize(14),l.text("Summary Report",14,15);const x=l.splitTextToSize(w.summaryReport,180);l.setFontSize(12),l.text(x,14,35),l.save("PlanMonitoringSummary.pdf"),u("Summary report generated successfully","success")}catch{u("Error generating summary report","error")}finally{i(o,!1)}};var Na=$("<div><span> </span></div>"),Ca=$('<span> </span> <span class="text-gray-500 ml-1">achieved</span>',1),Ea=$('<span class="text-gray-500">No plans available</span>'),Pa=(m,o)=>i(o,!t(o)),Ma=(m,o,v,u,n)=>{i(o,y(t(v).value)),i(u,!1),n()},La=$("<button> </button>"),ja=$('<div class="absolute top-full left-0 mt-1 w-48 rounded-lg bg-popover shadow-lg border border-border z-10"></div>'),Ra=(m,o)=>i(o,!t(o)),za=(m,o,v,u,n)=>{i(o,y(t(v)==="All Departments"?"all":t(v))),i(u,!1),n()},Da=$("<button> </button>"),Oa=$('<div class="absolute top-full left-0 mt-1 w-56 rounded-lg bg-popover shadow-lg border border-border z-10"></div>'),Fa=(m,o)=>i(o,!t(o)),Ta=(m,o,v,u)=>{i(o,y(t(v).name)),i(u,!1)},Ia=$("<button> </button>"),Va=$('<div class="absolute top-full left-0 mt-1 w-56 rounded-lg bg-white dark:bg-gray-800 shadow-lg border border-gray-200 dark:border-gray-700 z-10"></div>'),Ga=(m,o)=>i(o,!t(o)),qa=(m,o,v,u,n)=>{i(o,y(t(v)==="All Objectives"?"all":t(v))),i(u,!1),n()},Ka=$("<button> </button>"),Ua=$('<div class="absolute top-full left-0 mt-1 w-56 rounded-lg bg-white dark:bg-gray-800 shadow-lg border border-gray-200 dark:border-gray-700 z-10"></div>'),Ya=$('<div class="flex items-center justify-center p-8"><!> <span class="ml-2 text-muted-foreground">Loading plans...</span></div>'),Ha=$('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><span> </span></td><td class="px-4 py-3 text-muted-foreground"> </td></tr>'),Ba=(m,o)=>Se(o,-1),Ja=(m,o)=>Se(o),Qa=$('<table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left">Department</th><th class="px-4 py-3 text-left">Action Plans</th><th class="px-4 py-3 text-left">KPI</th><th class="px-4 py-3 text-left">Target Output</th><th class="px-4 py-3 text-left">Actions Taken</th><th class="px-4 py-3 text-left">Statement</th><th class="px-4 py-3 text-left">Status</th><th class="px-4 py-3 text-left">Completed</th></tr></thead><tbody class="divide-y divide-border"></tbody></table> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 p-4 bg-muted/50 border-t border-border"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring"><option>5 per page</option><option>10 per page</option><option>25 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Next</button></div></div></div>',1),Za=$('<div class="text-center p-8 text-muted-foreground">No plans found matching your criteria.</div>'),Wa=$('<div class="flex flex-col gap-4 p-4 container mx-auto"><!> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Plans Monitoring</h1></div></div> <div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div class="bg-card rounded-md shadow-sm border border-border p-4"><h3 class="text-sm font-medium text-muted-foreground">Total Plans</h3> <p class="text-4xl font-semibold mt-2"> </p> <p class="text-md mt-3"><!></p></div> <div class="bg-card rounded-lg shadow border border-border p-4"><h3 class="text-sm font-medium text-muted-foreground">Achieved</h3> <p class="text-4xl font-semibold text-green-600 mt-2"> </p></div> <div class="bg-card rounded-lg shadow border border-border p-4"><h3 class="text-sm font-medium text-muted-foreground">Not Achieved</h3> <p class="text-4xl font-semibold text-red-600 mt-2"> </p></div> <div class="bg-card rounded-lg shadow border border-border p-4 min-h-[240px]"><h3 class="text-sm font-medium text-muted-foreground mb-2">Achievement Rate</h3> <!></div></div> <div class="flex flex-col md:flex-row gap-4 mb-2 items-center justify-between"><div class="flex flex-col md:flex-row gap-4 flex-1"><div class="relative flex-1 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search plans..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <div class="relative"><button class="px-4 py-2 bg-secondary rounded-lg text-sm font-medium hover:bg-secondary/80 transition-colors flex items-center gap-2"> <!></button> <!></div> <div class="relative"><button class="px-4 py-2 bg-secondary rounded-lg text-sm font-medium hover:bg-secondary/80 transition-colors flex items-center gap-2"><!> <!></button> <!></div> <div class="relative"><button class="px-4 py-2 rounded-lg text-sm font-medium bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"> <!></button> <!></div> <div class="relative"><button class="px-4 py-2 rounded-lg text-sm font-medium bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"> <!></button> <!></div></div> <div class="flex gap-2"><button class="flex items-center gap-2 bg-secondary text-foreground px-4 py-2 rounded-lg hover:bg-secondary/80 justify-center flex-1 md:flex-initial whitespace-nowrap"><!> Export PDF</button> <button class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"><!> Generate Report</button></div></div> <div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><!></div></div>');function li(m,o){we(o,!0);let v=s(y([])),u=s(y([])),n=s("all"),w=s("all"),l=s(!0),x=s(!1),E=s(""),Q=s(!1),et=s(!1),Y=s(!1),ft=s(""),I=s("success"),pt=s(1),bt=s(5),xt=_t(()=>Math.ceil(t(u).length/t(bt))),kt=_t(()=>t(u).slice((t(pt)-1)*t(bt),t(pt)*t(bt)));const At=_t(()=>({achieved:t(u).filter(p=>p.is_accomplished).length,notAchieved:t(u).filter(p=>!p.is_accomplished).length}));let dt=s(y([])),jt=s("all"),Bt=s(!1),oe=s(y([])),Jt=s("all"),Qt=s(!1),V=s(y([]));const J=[{value:"all",label:"All Status"},{value:"achieved",label:"Achieved"},{value:"not_achieved",label:"Not Achieved"}],W=p=>{var S;return((S=J.find(j=>j.value===p))==null?void 0:S.label)||"All Status"},Et=(p,S)=>{i(ft,y(p)),i(I,y(S)),i(Y,!0),setTimeout(()=>{i(Y,!1)},3e3)},Pt=async()=>{i(l,!0);try{const{data:p,error:S}=await wt.from("plan_monitoring").select(`
				id,
				action_plan_id,
				evaluation,
				statement,
				is_accomplished,
				time_completed,
				department_id,
				action_plans (
					actions_taken,
					kpi,
					target_output,
					objective_id,
					strategic_objectives (
						name,
						strategic_goal_id,
						strategic_goals (name, goal_no)
					)
				)
			`);if(S)throw S;const{data:j,error:L}=await wt.from("departments").select("id, name");if(L)throw L;const A=Object.fromEntries(j.map(K=>[K.id,K.name]));i(v,y(p.map(K=>{var Ft,Ht,pe,ce,ne,de,te,Nt,ve,xe,me;return{id:K.id,action_plan_id:K.action_plan_id,evaluation:K.evaluation,statement:K.statement,is_accomplished:K.is_accomplished,time_completed:K.time_completed,department:A[K.department_id]||"Unassigned",actions_taken:((Ft=K.action_plans)==null?void 0:Ft.actions_taken)||"No Actions Taken",kpi:((Ht=K.action_plans)==null?void 0:Ht.kpi)||"No KPI",target_output:((pe=K.action_plans)==null?void 0:pe.target_output)||"No Target Output",objective:((ne=(ce=K.action_plans)==null?void 0:ce.strategic_objectives)==null?void 0:ne.name)||"No Objective",goal:((Nt=(te=(de=K.action_plans)==null?void 0:de.strategic_objectives)==null?void 0:te.strategic_goals)==null?void 0:Nt.name)||"No Goal",goal_no:((me=(xe=(ve=K.action_plans)==null?void 0:ve.strategic_objectives)==null?void 0:xe.strategic_goals)==null?void 0:me.goal_no)||0}}))),ae()}catch(p){console.error("Error fetching data:",p)}finally{i(l,!1)}},Gt=async()=>{try{const{data:p,error:S}=await wt.from("departments").select("name");if(S)throw S;i(dt,y(["All Departments",...p.map(j=>j.name)]))}catch{Et("Error fetching departments","error")}},Rt=async()=>{try{const{data:p,error:S}=await wt.from("strategic_goals").select("name, goal_no");if(S)throw S;i(oe,y([{name:"All Goals",goal_no:null},...p.map(j=>({name:`${j.goal_no} - ${j.name}`,goal_no:j.goal_no}))]))}catch(p){console.error("Error fetching strategic goals:",p)}},Zt=async()=>{try{const p=t(oe).find(A=>A.name===t(jt));let S=wt.from("strategic_objectives").select("name, strategic_goal_id");t(jt)!=="all"&&(p!=null&&p.goal_no)&&(S=S.eq("strategic_goal_id",p.goal_no));const{data:j,error:L}=await S;if(L)throw L;i(V,y(["All Objectives",...j.map(A=>A.name)])),console.log("Strategic Objectives:",t(V))}catch(p){console.error("Error fetching strategic objectives:",p),i(V,y(["All Objectives"]))}};Fe(()=>{t(jt)!=="all"?Zt():i(V,y(["All Objectives"]))});const ae=()=>{var S;let p=t(v);if(t(n)==="achieved"?p=p.filter(j=>j.is_accomplished):t(n)==="not_achieved"&&(p=p.filter(j=>!j.is_accomplished)),t(w)!=="all"&&(p=p.filter(j=>j.department===t(w))),t(jt)!=="all"){const j=(S=t(oe).find(L=>L.name===t(jt)))==null?void 0:S.goal_no;j&&(p=p.filter(L=>L.goal_no===j))}if(t(Jt)!=="all"&&(p=p.filter(j=>j.objective===t(Jt))),t(E)){const j=t(E).toLowerCase();p=p.filter(L=>{var A,K,Ft,Ht;return((A=L.statement)==null?void 0:A.toLowerCase().includes(j))||((K=L.actions_taken)==null?void 0:K.toLowerCase().includes(j))||((Ft=L.kpi)==null?void 0:Ft.toLowerCase().includes(j))||((Ht=L.department)==null?void 0:Ht.toLowerCase().includes(j))})}i(u,y(p)),i(pt,1)},le=_t(()=>t(u).length>0?(t(At).achieved/t(u).length*100).toFixed(1):0),zt=_t(()=>Number(t(le))>=50?"text-green-600":"text-red-600");Pt(),Gt(),Rt(),Zt(),Fe(()=>{ae()});var Dt=Wa(),qt=a(Dt);rt(qt,()=>t(Y),p=>{var S=Na(),j=a(S),L=a(j,!0);e(j),e(S),O(()=>{fe(S,`flex items-center p-4 rounded-lg ${(t(I)==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800")??""}`),g(L,t(ft))}),he(3,S,()=>$e),_(p,S)});var Wt=r(qt,2),Kt=a(Wt),Xt=a(Kt);da(Xt,{class:"w-8 h-8 text-primary"}),Ct(2),e(Kt),e(Wt);var Ut=r(Wt,2),U=a(Ut),N=r(a(U),2),P=a(N,!0);e(N);var H=r(N,2),ot=a(H);rt(ot,()=>t(u).length>0,p=>{var S=Ca(),j=St(S),L=a(j);e(j),Ct(2),O(()=>{fe(j,t(zt)),g(L,`${t(le)??""}%`)}),_(p,S)},p=>{var S=Ea();_(p,S)}),e(H),e(U);var c=r(U,2),C=r(a(c),2),q=a(C,!0);e(C),e(c);var D=r(c,2),M=r(a(D),2),ht=a(M,!0);e(M),e(D);var d=r(D,2),f=r(a(d),2);$a(f,{get chartData(){return t(At)}}),e(d),e(Ut);var k=r(Ut,2),h=a(k),b=a(h),R=a(b);Le(R,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var Z=r(R,2);Me(Z),e(b);var G=r(b,2),B=a(G);B.__click=[Pa,Q];var lt=a(B);O(()=>g(lt,`${W(t(n))??""} `));var it=r(lt);Re(it,{class:"w-4 h-4"}),e(B);var st=r(B,2);rt(st,()=>t(Q),p=>{var S=ja();ee(S,21,()=>J,se,(j,L)=>{var A=La();A.__click=[Ma,n,L,Q,ae];var K=a(A,!0);e(A),O(()=>{fe(A,`w-full px-4 py-2 text-left text-sm hover:bg-muted/50 first:rounded-t-lg last:rounded-b-lg ${(t(n)===t(L).value?"bg-muted/50":"")??""}`),g(K,t(L).label)}),_(j,A)}),e(S),_(p,S)}),e(G);var X=r(G,2),T=a(X);T.__click=[Ra,et];var ct=a(T);wa(ct,{class:"w-4 h-4"});var F=r(ct),z=r(F);Re(z,{class:"w-4 h-4"}),e(T);var vt=r(T,2);rt(vt,()=>t(et),p=>{var S=Oa();ee(S,21,()=>t(dt),se,(j,L)=>{var A=Da();const K=_t(()=>`w-full px-4 py-2 text-left text-sm hover:bg-muted/50 first:rounded-t-lg last:rounded-b-lg ${(t(w)===t(L).toLowerCase()?"bg-muted/50":"")??""}`);A.__click=[za,w,L,et,ae];var Ft=a(A,!0);e(A),O(()=>{fe(A,t(K)),g(Ft,t(L))}),_(j,A)}),e(S),_(p,S)}),e(X);var ut=r(X,2),nt=a(ut);nt.__click=[Fa,Bt];var Tt=a(nt),gt=r(Tt);Re(gt,{class:"w-4 h-4"}),e(nt);var Mt=r(nt,2);rt(Mt,()=>t(Bt),p=>{var S=Va();ee(S,21,()=>t(oe),se,(j,L)=>{var A=Ia();A.__click=[Ta,jt,L,Bt];var K=a(A,!0);e(A),O(()=>{fe(A,`w-full px-4 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-gray-700 first:rounded-t-lg last:rounded-b-lg ${(t(jt)===t(L).name?"bg-gray-50 dark:bg-gray-700":"")??""}`),g(K,t(L).name)}),_(j,A)}),e(S),_(p,S)}),e(ut);var It=r(ut,2),Lt=a(It);Lt.__click=[Ga,Qt];var mt=a(Lt),Ot=r(mt);Re(Ot,{class:"w-4 h-4"}),e(Lt);var Vt=r(Lt,2);rt(Vt,()=>t(Qt),p=>{var S=Ua();ee(S,21,()=>t(V),se,(j,L)=>{var A=Ka();A.__click=[qa,Jt,L,Qt,ae];var K=a(A,!0);e(A),O(()=>{fe(A,`w-full px-4 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-gray-700 first:rounded-t-lg last:rounded-b-lg ${(t(Jt)===t(L)?"bg-gray-50 dark:bg-gray-700":"")??""}`),g(K,t(L))}),_(j,A)}),e(S),_(p,S)}),e(It),e(h);var _e=r(h,2),$t=a(_e);$t.__click=[Sa,u,At,Et];var re=a($t);ra(re,{class:"w-4 h-4"}),Ct(),e($t);var tt=r($t,2);tt.__click=[Aa,x,u,Et];var at=a(tt);rt(at,()=>t(x),p=>{ze(p,{class:"w-4 h-4 animate-spin"})},p=>{na(p,{class:"w-4 h-4"})}),Ct(),e(tt),e(_e),e(k);var yt=r(k,2),Yt=a(yt);rt(Yt,()=>t(l),p=>{var S=Ya(),j=a(S);ze(j,{class:"w-6 h-6 animate-spin text-primary"}),Ct(2),e(S),_(p,S)},p=>{var S=ue(),j=St(S);rt(j,()=>t(u).length>0,L=>{var A=Qa(),K=St(A),Ft=r(a(K));ee(Ft,21,()=>t(kt),se,(je,ge)=>{var Ve=Ha(),Ge=a(Ve),ca=a(Ge,!0);e(Ge);var qe=r(Ge),va=a(qe,!0);e(qe);var Ke=r(qe),ua=a(Ke,!0);e(Ke);var Ue=r(Ke),_a=a(Ue,!0);e(Ue);var Ye=r(Ue),pa=a(Ye,!0);e(Ye);var He=r(Ye),ga=a(He,!0);e(He);var Be=r(He),Je=a(Be),ma=a(Je,!0);e(Je),e(Be);var Ze=r(Be),fa=a(Ze,!0);O(()=>g(fa,t(ge).time_completed?new Date(t(ge).time_completed).toLocaleString():"N/A")),e(Ze),e(Ve),O(()=>{g(ca,t(ge).department),g(va,t(ge).actions_taken),g(ua,t(ge).kpi),g(_a,t(ge).target_output),g(pa,t(ge).evaluation||"Pending"),g(ga,t(ge).statement||"Pending"),fe(Je,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${(t(ge).is_accomplished?"bg-green-100 text-green-800":"bg-red-100 text-red-800")??""}`),g(ma,t(ge).is_accomplished?"Achieved":"Not Achieved")}),_(je,Ve)}),e(Ft),e(K);var Ht=r(K,2),pe=a(Ht),ce=a(pe);O(()=>g(ce,`Showing ${(t(pt)-1)*t(bt)+1} to ${Math.min(t(pt)*t(bt),t(u).length)??""} of ${t(u).length??""} results`)),e(pe);var ne=r(pe,2),de=a(ne),te=a(de);te.value=(te.__value=5)==null?"":5;var Nt=r(te);Nt.value=(Nt.__value=10)==null?"":10;var ve=r(Nt);ve.value=(ve.__value=25)==null?"":25,e(de);var xe=r(de,2),me=a(xe);me.__click=[Ba,pt];var Oe=r(me,2);Oe.__click=[Ja,pt],e(xe),e(ne),e(Ht),O(()=>{me.disabled=t(pt)===1,Oe.disabled=t(pt)===t(xt)}),ie(de,()=>t(bt),je=>i(bt,je)),_(L,A)},L=>{var A=Za();_(L,A)},!0),_(p,S)}),e(yt),e(Dt),O(()=>{g(P,t(u).length),g(q,t(At).achieved||0),g(ht,t(At).notAchieved),g(F,` ${(t(w)==="all"?"All Departments":t(w))??""} `),g(Tt,`${(t(jt)==="all"?"All Goals":t(jt))??""} `),g(mt,`${(t(Jt)==="all"?"All Objectives":t(Jt))??""} `),tt.disabled=t(x)}),ye(Z,()=>t(E),p=>i(E,p)),_(m,Dt),ke()}Pe(["click"]);var Xa=$('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),tr=(m,o)=>o("rrn"),er=(m,o)=>o("risk_statement"),ar=(m,o)=>o("likelihood_rating"),rr=(m,o)=>o("severity"),or=$('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3 hidden lg:table-cell"> </td><td class="px-4 py-3 hidden lg:table-cell"> </td><td class="px-4 py-3 hidden md:table-cell"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><span> </span></td></tr>'),ir=$('<table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">RRN <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Risk Statement <!></button></th><th class="px-4 py-3 text-left hidden lg:table-cell"><button class="flex items-center gap-1">Likelihood Rating <!></button></th><th class="px-4 py-3 text-left hidden lg:table-cell"><button class="flex items-center gap-1">Severity <!></button></th><th class="px-4 py-3 text-left hidden md:table-cell">Control Rating</th><th class="px-4 py-3 text-left">Monitoring Rating</th><th class="px-4 py-3 text-left">Status</th></tr></thead><tbody class="divide-y divide-border"></tbody></table>'),sr=(m,o)=>Se(o,-1),lr=(m,o)=>Se(o),nr=$('<div class="flex flex-col gap-4 p-4 container mx-auto"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Risk Monitoring</h1></div></div> <div class="flex flex-col md:flex-row gap-4 mb-2 items-center justify-between"><div class="flex flex-col md:flex-row gap-4 flex-1"><div class="relative flex-1 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search risks..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[200px]"><option>All Status</option><option>Achieved</option><option>Still mitigating</option></select></div></div> <div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><!></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring"><option>5 per page</option><option>10 per page</option><option>25 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Next</button></div></div></div></div>');function ni(m,o){we(o,!0);let v=s(y([])),u=s(!0),n=s(null),w=s(""),l=s(1),x=s(5),E=s("rrn"),Q=s("asc"),et=s("all");const Y=async()=>{try{const{data:U,error:N}=await wt.from("risk_monitoring").select(`
                id,
                risks (
                    rrn,
                    risk_statement
                ),
                likelihood_rating:likelihood_rating_id(name),
                severity:severity_id(name),
                control_rating:control_rating_id(name),
                monitoring_rating:monitoring_rating_id(status),
                is_achieved
            `);if(N)throw N;i(v,y(U.map(P=>{var H,ot,c,C;return{id:P.id,rrn:P.risks.rrn,risk_statement:P.risks.risk_statement,likelihood_rating:((H=P.likelihood_rating)==null?void 0:H.name)||"Not Available",severity:((ot=P.severity)==null?void 0:ot.name)||"Not Available",control_rating:((c=P.control_rating)==null?void 0:c.name)||"Not Available",monitoring_rating:((C=P.monitoring_rating)==null?void 0:C.status)||"Not Available",is_achieved:P.is_achieved}})))}catch(U){console.error("Error fetching risk monitoring data:",U),i(n,"Failed to fetch risk monitoring data.")}finally{i(u,!1)}},ft=U=>{t(E)===U?i(Q,y(t(Q)==="asc"?"desc":"asc")):(i(E,y(U)),i(Q,"asc"))},I=_t(()=>t(v).filter(U=>{const P=`${U.rrn} ${U.risk_statement} ${U.likelihood_rating} ${U.severity} ${U.control_rating} ${U.monitoring_rating}`.toLowerCase().includes(t(w).toLowerCase()),H=t(et)==="all"||U.is_achieved===t(et);return P&&H}).sort((U,N)=>{const P=String(U[t(E)]),H=String(N[t(E)]);return t(Q)==="asc"?P.localeCompare(H):H.localeCompare(P)})),pt=_t(()=>t(I).slice((t(l)-1)*t(x),t(l)*t(x))),bt=_t(()=>Math.ceil(t(I).length/t(x)));Y();var xt=nr(),kt=a(xt),At=a(kt),dt=a(At);oa(dt,{class:"w-8 h-8 text-primary"}),Ct(2),e(At),e(kt);var jt=r(kt,2),Bt=a(jt),oe=a(Bt),Jt=a(oe);Le(Jt,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var Qt=r(Jt,2);Me(Qt),e(oe);var V=r(oe,2),J=a(V);J.value=(J.__value="all")==null?"":"all";var W=r(J);W.value=(W.__value=!0)==null?"":!0;var Et=r(W);Et.value=(Et.__value=!1)==null?"":!1,e(V),e(Bt),e(jt);var Pt=r(jt,2),Gt=a(Pt);rt(Gt,()=>t(u),U=>{var N=Xa();_(U,N)},U=>{var N=ir(),P=a(N),H=a(P),ot=a(H),c=a(ot);c.__click=[tr,ft];var C=r(a(c)),q=_t(()=>t(E)==="rrn"?"text-primary":"");be(C,{size:16,get class(){return t(q)}}),e(c),e(ot);var D=r(ot),M=a(D);M.__click=[er,ft];var ht=r(a(M)),d=_t(()=>t(E)==="risk_statement"?"text-primary":"");be(ht,{size:16,get class(){return t(d)}}),e(M),e(D);var f=r(D),k=a(f);k.__click=[ar,ft];var h=r(a(k)),b=_t(()=>t(E)==="likelihood_rating"?"text-primary":"");be(h,{size:16,get class(){return t(b)}}),e(k),e(f);var R=r(f),Z=a(R);Z.__click=[rr,ft];var G=r(a(Z)),B=_t(()=>t(E)==="severity"?"text-primary":"");be(G,{size:16,get class(){return t(B)}}),e(Z),e(R),Ct(3),e(H),e(P);var lt=r(P);ee(lt,21,()=>t(pt),it=>it.id,(it,st)=>{var X=or(),T=a(X),ct=a(T,!0);e(T);var F=r(T),z=a(F,!0);e(F);var vt=r(F),ut=a(vt,!0);e(vt);var nt=r(vt),Tt=a(nt,!0);e(nt);var gt=r(nt),Mt=a(gt,!0);e(gt);var It=r(gt),Lt=a(It,!0);e(It);var mt=r(It),Ot=a(mt),Vt=a(Ot,!0);e(Ot),e(mt),e(X),O(()=>{g(ct,t(st).rrn),g(z,t(st).risk_statement),g(ut,t(st).likelihood_rating),g(Tt,t(st).severity),g(Mt,t(st).control_rating),g(Lt,t(st).monitoring_rating),fe(Ot,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${(t(st).is_achieved?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800")??""}`),g(Vt,t(st).is_achieved?"Achieved":"Still mitigating")}),_(it,X)}),e(lt),e(N),_(U,N)}),e(Pt);var Rt=r(Pt,2),Zt=a(Rt),ae=a(Zt);O(()=>g(ae,`Showing ${(t(l)-1)*t(x)+1} to ${Math.min(t(l)*t(x),t(I).length)??""} of ${t(I).length??""} results`)),e(Zt);var le=r(Zt,2),zt=a(le),Dt=a(zt);Dt.value=(Dt.__value=5)==null?"":5;var qt=r(Dt);qt.value=(qt.__value=10)==null?"":10;var Wt=r(qt);Wt.value=(Wt.__value=25)==null?"":25,e(zt);var Kt=r(zt,2),Xt=a(Kt);Xt.__click=[sr,l];var Ut=r(Xt,2);Ut.__click=[lr,l],e(Kt),e(le),e(Rt),e(xt),O(()=>{Xt.disabled=t(l)===1,Ut.disabled=t(l)===t(bt)}),ye(Qt,()=>t(w),U=>i(w,U)),ie(V,()=>t(et),U=>i(et,U)),ie(zt,()=>t(x),U=>i(x,U)),_(m,xt),ke()}Pe(["click"]);const dr=(m,o)=>{const v=new Ie;v.text("Opportunities Monitoring Report",14,20);const u=t(o).map(n=>[n.opt_statement,n.kpi,n.planned_actions,n.evaluation||"Pending",n.achieved?"Achieved":"Not Achieved",n.time_completed?new Date(n.time_completed).toLocaleString():"N/A"]);aa(v,{head:[["Statement","KPI","Actions","Evaluation","Status","Completed"]],body:u,startY:30}),v.save("opportunities.pdf")},cr=async(m,o,v)=>{i(o,!0);try{const u=await fetch("/api/summary-report-opt-monitoring",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({opportunities:t(v)})}),n=await u.json();if(!u.ok||n.error)throw new Error(n.error||"Failed to generate summary.");const w=new Ie,l="Summary Report";w.setFont("times","normal"),w.setFontSize(12),w.text("MANUEL S. ENVERGA UNIVERSITY FOUNDATION",14,10),w.setFontSize(10),w.text("SY 2024-2025",14,20),w.setFontSize(14),w.text(l,14,15);const x=w.splitTextToSize(n.summaryReport,180);w.setFontSize(12),w.text(x,14,35),w.save("OpportunitiesSummary.pdf")}catch(u){console.error("Error generating summary report:",u),alert("An error occurred while generating the summary report.")}finally{i(o,!1)}};var vr=$('<div class="flex justify-center items-center min-h-[200px]"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),ur=$("<option> </option>"),_r=(m,o)=>i(o,!t(o)),pr=(m,o,v,u,n)=>{i(o,y(t(v).value)),i(u,!1),n()},gr=$('<button class="w-full text-left px-4 py-2 hover:bg-secondary/80"> </button>'),mr=$('<div class="absolute right-0 mt-2 w-48 bg-card rounded-lg shadow-lg border border-border z-10"></div>'),fr=(m,o)=>o("opt_statement"),br=$('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><span> </span></td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td></tr>'),xr=(m,o)=>i(o,t(o)-1),hr=(m,o)=>i(o,t(o)+1),yr=$('<div class="flex flex-col gap-6"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Opportunities Monitoring</h1></div></div> <div class="flex flex-col md:flex-row justify-between items-center gap-4"><div class="relative flex-3 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search opportunities..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <div class="flex gap-2 items-center"><div class="relative"><select class="bg-secondary text-foreground px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"><option>All Departments</option><!></select></div> <div class="relative"><button class="flex items-center gap-2 bg-secondary text-foreground px-4 py-2 rounded-lg hover:bg-secondary/80"> <!></button> <!></div> <button class="flex items-center gap-2 bg-secondary text-foreground px-4 py-2 rounded-lg hover:bg-secondary/80"><!> Export</button> <button class="flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90"><!> Generate Report</button></div></div> <div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Statement <!></button></th><th class="px-4 py-3 text-left">KPI</th><th class="px-4 py-3 text-left">Actions</th><th class="px-4 py-3 text-left">Evaluation</th><th class="px-4 py-3 text-left">Status</th><th class="px-4 py-3 text-left">Remarks</th><th class="px-4 py-3 text-left">Completed</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex gap-2 items-center"><select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>'),wr=$('<div class="container mx-auto p-4"><!></div>');function di(m,o){we(o,!0);let v=s(y([])),u=s(y([])),n=s(y([])),w=s("all"),l=s("all"),x=s(!0),E=s(!1),Q=s(""),et=s(!1),Y=s("opt_statement"),ft=s("asc"),I=s(1),pt=s(5),bt=_t(()=>Math.ceil(t(n).length/t(pt))),xt=_t(()=>t(n).slice((t(I)-1)*t(pt),t(I)*t(pt)));const kt=[{value:"all",label:"All Status"},{value:"achieved",label:"Achieved"},{value:"not_achieved",label:"Not Achieved"}],At=V=>{var J;return((J=kt.find(W=>W.value===V))==null?void 0:J.label)||"All Status"},dt=V=>{t(Y)===V?i(ft,y(t(ft)==="asc"?"desc":"asc")):(i(Y,y(V)),i(ft,"asc")),Bt()},jt=async()=>{i(x,!0);try{const{data:V,error:J}=await wt.from("opt_monitoring").select(`
				opt_id,
				opportunities (
					opt_statement,
					kpi,
					planned_actions,
					department_id
				),
				statement,
				evaluation,
				is_accomplished,
				time_completed
			`);if(J){console.error("Error fetching opportunities:",J);return}V&&(i(v,y(V.map(W=>{var Et,Pt,Gt,Rt;return{id:W.opt_id,opt_statement:((Et=W.opportunities)==null?void 0:Et.opt_statement)||"No Statement Available",kpi:((Pt=W.opportunities)==null?void 0:Pt.kpi)||"No KPI Available",planned_actions:((Gt=W.opportunities)==null?void 0:Gt.planned_actions)||"No Actions Available",evaluation:W.evaluation||"Pending Evaluation",statement:W.statement||"No Statement Available",achieved:W.is_accomplished||!1,time_completed:W.time_completed||null,department_id:((Rt=W.opportunities)==null?void 0:Rt.department_id)||null}}))),Bt())}catch(V){console.error("Unexpected error during data fetch:",V)}finally{i(x,!1)}},Bt=()=>{let V=t(v);if(t(l)==="achieved"?V=V.filter(J=>J.achieved):t(l)==="not_achieved"&&(V=V.filter(J=>!J.achieved)),t(w)!=="all"&&(V=V.filter(J=>J.department_id===t(w))),t(Q)){const J=t(Q).toLowerCase();V=V.filter(W=>W.opt_statement.toLowerCase().includes(J)||W.kpi.toLowerCase().includes(J)||W.planned_actions.toLowerCase().includes(J))}V.sort((J,W)=>{const Et=String(J[t(Y)]),Pt=String(W[t(Y)]);return t(ft)==="asc"?Et.localeCompare(Pt):Pt.localeCompare(Et)}),i(n,y(V)),i(I,1)},oe=async()=>{try{const{data:V,error:J}=await wt.from("departments").select("id, name");if(J){console.error("Error fetching departments:",J);return}i(u,y(V||[]))}catch(V){console.error("Unexpected error fetching departments:",V)}};Fe(()=>{Bt()}),jt(),oe();var Jt=wr(),Qt=a(Jt);rt(Qt,()=>t(x),V=>{var J=vr();_(V,J)},V=>{var J=yr(),W=a(J),Et=a(W),Pt=a(Et);ia(Pt,{class:"w-8 h-8 text-primary"}),Ct(2),e(Et),e(W);var Gt=r(W,2),Rt=a(Gt),Zt=a(Rt);Le(Zt,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var ae=r(Zt,2);Me(ae),e(Rt);var le=r(Rt,2),zt=a(le),Dt=a(zt),qt=a(Dt);qt.value=(qt.__value="all")==null?"":"all";var Wt=r(qt);ee(Wt,17,()=>t(u),se,(F,z)=>{var vt=ur(),ut={},nt=a(vt,!0);e(vt),O(()=>{ut!==(ut=t(z).id)&&(vt.value=(vt.__value=t(z).id)==null?"":t(z).id),g(nt,t(z).name)}),_(F,vt)}),e(Dt),e(zt);var Kt=r(zt,2),Xt=a(Kt);Xt.__click=[_r,et];var Ut=a(Xt);O(()=>g(Ut,`${At(t(l))??""} `));var U=r(Ut);Re(U,{size:20}),e(Xt);var N=r(Xt,2);rt(N,()=>t(et),F=>{var z=mr();ee(z,21,()=>kt,se,(vt,ut)=>{var nt=gr();nt.__click=[pr,l,ut,et,Bt];var Tt=a(nt,!0);e(nt),O(()=>g(Tt,t(ut).label)),_(vt,nt)}),e(z),_(F,z)}),e(Kt);var P=r(Kt,2);P.__click=[dr,n];var H=a(P);ra(H,{size:20}),Ct(),e(P);var ot=r(P,2);ot.__click=[cr,E,n];var c=a(ot);rt(c,()=>t(E),F=>{ze(F,{class:"animate-spin",size:20})},F=>{na(F,{size:20})}),Ct(),e(ot),e(le),e(Gt);var C=r(Gt,2),q=a(C),D=a(q),M=a(D),ht=a(M),d=a(ht);d.__click=[fr,dt];var f=r(a(d)),k=_t(()=>t(Y)==="opt_statement"?"text-primary":"");be(f,{size:16,get class(){return t(k)}}),e(d),e(ht),Ct(6),e(M),e(D);var h=r(D);ee(h,21,()=>t(xt),se,(F,z)=>{var vt=br(),ut=a(vt),nt=a(ut,!0);e(ut);var Tt=r(ut),gt=a(Tt,!0);e(Tt);var Mt=r(Tt),It=a(Mt,!0);e(Mt);var Lt=r(Mt),mt=a(Lt,!0);e(Lt);var Ot=r(Lt),Vt=a(Ot),_e=a(Vt,!0);e(Vt),e(Ot);var $t=r(Ot),re=a($t,!0);e($t);var tt=r($t),at=a(tt,!0);O(()=>g(at,t(z).time_completed?new Date(t(z).time_completed).toLocaleString():"N/A")),e(tt),e(vt),O(()=>{g(nt,t(z).opt_statement),g(gt,t(z).kpi),g(It,t(z).planned_actions),g(mt,t(z).evaluation||"Pending"),fe(Vt,`inline-flex px-2 py-1 rounded-full text-xs font-medium ${(t(z).achieved?"bg-green-100 text-green-800":"bg-red-100 text-red-800")??""}`),g(_e,t(z).achieved?"Achieved":"Not Achieved"),g(re,t(z).statement)}),_(F,vt)}),e(h),e(q),e(C);var b=r(C,2),R=a(b),Z=a(R);O(()=>g(Z,`Showing ${(t(I)-1)*t(pt)+1} to ${Math.min(t(I)*t(pt),t(n).length)??""} of ${t(n).length??""} results`)),e(R);var G=r(R,2),B=a(G),lt=a(B);lt.value=(lt.__value=5)==null?"":5;var it=r(lt);it.value=(it.__value=10)==null?"":10;var st=r(it);st.value=(st.__value=25)==null?"":25;var X=r(st);X.value=(X.__value=50)==null?"":50,e(B);var T=r(B,2);T.__click=[xr,I];var ct=r(T,2);ct.__click=[hr,I],e(G),e(b),e(J),O(()=>{ot.disabled=t(E),T.disabled=t(I)===1,ct.disabled=t(I)===t(bt)}),ye(ae,()=>t(Q),F=>i(Q,F)),ie(Dt,()=>t(w),F=>i(w,F)),ie(B,()=>t(pt),F=>i(pt,F)),_(V,J)}),e(Jt),_(m,Jt),ke()}Pe(["click"]);const kr=async(m,o,v,u,n,w)=>{if(t(o)){i(v,!0),i(u,y(t(u).map(l=>{var x;return l.id===((x=t(o))==null?void 0:x.id)?{...l,isLoading:!0}:l})));try{const l=await fetch("/api/evaluate-goal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target:t(o).target_output,evaluation:t(n)})}),x=await l.json();if(!l.ok||x.error)throw new Error(x.error||"Failed to evaluate action plan.");const E=x.aiEvaluation;if(typeof E!="string")throw new TypeError("AI evaluation response is not valid.");const et=!["not achieved","unsuccessful","failed","incomplete","fell short","below target","did not meet","not"].some(I=>E.toLowerCase().includes(I)),Y=et?new Date().toISOString():null,{error:ft}=await wt.from("plan_monitoring").update({evaluation:t(n),statement:E,is_accomplished:et,time_completed:Y}).eq("action_plan_id",t(o).id);if(ft)throw ft;i(u,y(t(u).map(I=>{var pt;return I.id===((pt=t(o))==null?void 0:pt.id)?{...I,is_accomplished:et,evaluation:t(n),statement:E,time_completed:Y,isLoading:!1}:I}))),w()}catch(l){console.error("Error evaluating action plan:",l),i(u,y(t(u).map(x=>{var E;return x.id===((E=t(o))==null?void 0:E.id)?{...x,isLoading:!1}:x})))}finally{i(v,!1)}}};var $r=$("<option> </option>"),Sr=$('<div class="flex items-center justify-center min-h-screen "><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Ar=(m,o)=>o("strategic_goal_name"),Nr=(m,o)=>o("objective_name"),Cr=(m,o,v)=>o(t(v)),Er=$('<button class="shrink-0 inline-flex items-center px-3 py-1 text-sm bg-primary text-primary-foreground hover:bg-primary/90 rounded-md">Evaluate</button>'),Pr=$("<!> Achieved",1),Mr=$("<!> Pending",1),Lr=(m,o,v)=>o(t(v).statement||""),jr=$('<button class="inline-flex items-center gap-1.5 px-2.5 py-1.5 text-sm text-primary bg-primary/10 hover:bg-primary/20 rounded-md"><!> View</button>'),Rr=$('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><div class="flex items-center gap-2"><p> </p></div></td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><!></td><td class="px-4 py-3"><span><!></span></td><td class="px-4 py-3"><div class="flex items-center justify-center"><!></div></td></tr>'),zr=(m,o)=>i(o,t(o)-1),Dr=(m,o)=>i(o,t(o)+1),Or=$('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Strategic Goal <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Objective <!></button></th><th class="px-4 py-3 text-left">Action Plans</th><th class="px-4 py-3 text-left">KPI</th><th class="px-4 py-3 text-left">Target Output</th><th class="px-4 py-3 text-left">Actions Taken</th><th class="px-4 py-3 text-left">Status</th><th class="px-4 py-3 text-center">Statement</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring w-full sm:w-auto"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>',1),Fr=$('<div class="text-center py-12 bg-card rounded-lg shadow"><p class="text-muted-foreground">No action plans found.</p></div>'),Tr=$('<div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"><div class="bg-background rounded-lg shadow-xl w-full max-w-lg mx-4"><div class="flex items-center justify-between p-4 border-b border-border"><h2 class="text-lg font-semibold">Actions Taken</h2> <button class="p-1 hover:bg-muted rounded-full"><!></button></div> <div class="p-4"><div class="mb-4"><label class="block text-sm font-medium mb-1">Action Plan</label> <p class="text-muted-foreground"> </p></div> <div class="mb-4"><label class="block text-sm font-medium mb-1">KPI</label> <p class="text-muted-foreground"> </p></div> <div class="mb-4"><label class="block text-sm font-medium mb-1">Target Output</label> <p class="text-muted-foreground"> </p></div> <div class="mb-6"><label class="block text-sm font-medium mb-1">Actions Taken to Achieve Action Plan</label> <textarea class="w-full h-32 px-3 py-2 text-sm bg-secondary rounded-md border border-border focus:outline-none focus:ring-2 focus:ring-ring resize-none" placeholder="Enter your actions..."></textarea></div> <div class="flex justify-end gap-3"><button class="px-4 py-2 text-sm hover:bg-muted rounded-md">Cancel</button> <button class="px-4 py-2 text-sm bg-primary text-primary-foreground hover:bg-primary/90 rounded-md disabled:opacity-50"> </button></div></div></div></div>'),Ir=(m,o)=>i(o,!1),Vr=(m,o)=>i(o,!1),Gr=$('<div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"><div class="bg-background rounded-lg shadow-xl w-full max-w-lg mx-4"><div class="flex items-center justify-between p-4 border-b border-border"><h2 class="text-lg font-semibold">Evaluation Statement</h2> <button class="p-1 hover:bg-muted rounded-full"><!></button></div> <div class="p-4"><div class="bg-muted rounded-lg p-4 text-muted-foreground max-h-[60vh] overflow-y-auto break-words"> </div> <div class="flex justify-end mt-4"><button class="px-4 py-2 text-sm bg-primary text-primary-foreground hover:bg-primary/90 rounded-md">Close</button></div></div></div></div>'),qr=$('<div class="flex flex-col gap-4 p-4 container mx-auto min-h-screen bg-background text-foreground"><div class="flex flex-col gap-4"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Plans Monitoring</h1></div></div> <div class="flex flex-col sm:flex-row gap-4"><div class="relative flex-1 sm:flex-none max-w-[300px]"><!> <input type="search" placeholder="Search plans..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full sm:w-[200px]"><option>All Status</option><option>Achieved</option><option>Pending</option></select> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full sm:w-[200px]"></select></div></div> <div class="flex-1"><!></div> <!> <!></div>');function ci(m,o){we(o,!0);let v=s(""),u=s("strategic_goal_name"),n=s(!0),w=s("all"),l=s("all"),x=s(!1),E=s(null),Q=s(""),et=s(!1),Y=s(""),ft=s(!0),I=s(y([])),pt=s(null),bt=s(!1),xt=s(1),kt=s(5);const At=_t(()=>["all",...new Set(t(I).map(c=>c.strategic_goal_name))]),dt=_t(()=>t(I).filter(c=>{const C=c.strategic_goal_name.toLowerCase().includes(t(v).toLowerCase())||c.objective_name.toLowerCase().includes(t(v).toLowerCase())||c.actions_taken.toLowerCase().includes(t(v).toLowerCase()),q=t(w)==="all"?!0:t(w)==="achieved"?c.is_accomplished:!c.is_accomplished,D=t(l)==="all"||c.strategic_goal_name===t(l);return C&&q&&D})),jt=_t(()=>t(dt).sort((c,C)=>{const q=t(n)?1:-1;return c[t(u)]>C[t(u)]?q:-q}).slice((t(xt)-1)*t(kt),t(xt)*t(kt))),Bt=_t(()=>Math.ceil(t(dt).length/t(kt))),oe=c=>{t(u)===c?i(n,!t(n)):(i(u,y(c)),i(n,!0))},Jt=c=>{i(E,y(c)),i(Q,y(c.evaluation||"")),i(x,!0)},Qt=()=>{i(x,!1),i(E,null),i(Q,"")},V=c=>{i(Y,y(c)),i(et,!0)},J=async()=>{try{const{data:{session:c},error:C}=await wt.auth.getSession();if(C||!c)throw C;i(pt,y(c.user.id))}catch(c){console.error("Error fetching session:",c)}},W=async c=>{try{const{data:C,error:q}=await wt.from("plan_monitoring").select("action_plan_id, is_accomplished, evaluation, statement, time_completed").in("action_plan_id",c);if(q)throw q;return C}catch(C){return console.error("Error fetching monitoring data:",C),[]}},Et=async()=>{try{const{data:c,error:C}=await wt.from("profiles").select("department_id").eq("id",t(pt)).single();if(C||!(c!=null&&c.department_id))throw C;const{data:q,error:D}=await wt.from("profiles").select("id").eq("department_id",c.department_id);if(D)throw D;const M=q.map(h=>h.id),{data:ht,error:d}=await wt.from("action_plans").select(`
					id,
					actions_taken,
					kpi,
					target_output,
					objective_id,
					strategic_objectives (
						name,
						strategic_goals (name)
					),
					is_approved
				`).in("profile_id",M).eq("is_approved",!0);if(d)throw d;const f=ht.map(h=>{var b,R,Z;return{id:h.id,actions_taken:h.actions_taken,kpi:h.kpi,target_output:h.target_output||"No Target Output",objective_id:h.objective_id,strategic_goal_name:((R=(b=h.strategic_objectives)==null?void 0:b.strategic_goals)==null?void 0:R.name)||"No Goal Assigned",objective_name:((Z=h.strategic_objectives)==null?void 0:Z.name)||"No Objective Assigned",is_accomplished:!1,evaluation:null,statement:null,time_completed:null,isLoading:!1}}),k=await W(f.map(h=>h.id));i(I,y(f.map(h=>{const b=k.find(R=>R.action_plan_id===h.id);return{...h,is_accomplished:(b==null?void 0:b.is_accomplished)||!1,evaluation:(b==null?void 0:b.evaluation)||null,statement:(b==null?void 0:b.statement)||null,time_completed:(b==null?void 0:b.time_completed)||null}})))}catch(c){console.error("Error fetching action plans:",c)}finally{i(ft,!1)}};Te(async()=>{await J(),await Et()});var Pt=qr(),Gt=a(Pt),Rt=a(Gt),Zt=a(Rt),ae=a(Zt);da(ae,{class:"w-8 h-8 text-primary"}),Ct(2),e(Zt),e(Rt);var le=r(Rt,2),zt=a(le),Dt=a(zt);Le(Dt,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var qt=r(Dt,2);Me(qt),e(zt);var Wt=r(zt,2),Kt=a(Wt);Kt.value=(Kt.__value="all")==null?"":"all";var Xt=r(Kt);Xt.value=(Xt.__value="achieved")==null?"":"achieved";var Ut=r(Xt);Ut.value=(Ut.__value="pending")==null?"":"pending",e(Wt);var U=r(Wt,2);ee(U,21,()=>t(At),se,(c,C)=>{var q=$r(),D={},M=a(q,!0);e(q),O(()=>{D!==(D=t(C))&&(q.value=(q.__value=t(C))==null?"":t(C)),g(M,t(C)==="all"?"All Goals":t(C))}),_(c,q)}),e(U),e(le),e(Gt);var N=r(Gt,2),P=a(N);rt(P,()=>t(ft),c=>{var C=Sr();_(c,C)},c=>{var C=ue(),q=St(C);rt(q,()=>t(jt).length>0,D=>{var M=Or(),ht=St(M),d=a(ht),f=a(d),k=a(f),h=a(k),b=a(h);b.__click=[Ar,oe];var R=r(a(b)),Z=_t(()=>t(u)==="strategic_goal_name"?"text-primary":"");be(R,{size:16,get class(){return t(Z)}}),e(b),e(h);var G=r(h),B=a(G);B.__click=[Nr,oe];var lt=r(a(B)),it=_t(()=>t(u)==="objective_name"?"text-primary":"");be(lt,{size:16,get class(){return t(it)}}),e(B),e(G),Ct(6),e(k),e(f);var st=r(f);ee(st,21,()=>t(jt),se,(Lt,mt)=>{var Ot=Rr(),Vt=a(Ot),_e=a(Vt,!0);e(Vt);var $t=r(Vt),re=a($t,!0);e($t);var tt=r($t),at=a(tt),yt=a(at),Yt=a(yt,!0);e(yt),e(at),e(tt);var p=r(tt),S=a(p,!0);e(p);var j=r(p),L=a(j,!0);e(j);var A=r(j),K=a(A);rt(K,()=>t(mt).isLoading,te=>{ze(te,{class:"animate-spin h-5 w-5 text-primary ml-2"})},te=>{var Nt=ue(),ve=St(Nt);rt(ve,()=>t(mt).is_accomplished,xe=>{var me=ta();O(()=>g(me,t(mt).evaluation||"No evaluation")),_(xe,me)},xe=>{var me=ue(),Oe=St(me);rt(Oe,()=>!t(mt).is_accomplished,je=>{var ge=Er();ge.__click=[Cr,Jt,mt],_(je,ge)},null,!0),_(xe,me)},!0),_(te,Nt)}),e(A);var Ft=r(A),Ht=a(Ft),pe=a(Ht);rt(pe,()=>t(mt).is_accomplished,te=>{var Nt=Pr(),ve=St(Nt);la(ve,{size:14}),Ct(),_(te,Nt)},te=>{var Nt=Mr(),ve=St(Nt);Qe(ve,{size:14}),Ct(),_(te,Nt)}),e(Ht),e(Ft);var ce=r(Ft),ne=a(ce),de=a(ne);rt(de,()=>t(mt).statement,te=>{var Nt=jr();Nt.__click=[Lr,V,mt];var ve=a(Nt);sa(ve,{size:16}),Ct(),e(Nt),_(te,Nt)}),e(ne),e(ce),e(Ot),O(()=>{g(_e,t(mt).strategic_goal_name),g(re,t(mt).objective_name),g(Yt,t(mt).actions_taken),g(S,t(mt).kpi),g(L,t(mt).target_output),fe(Ht,`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium ${(t(mt).is_accomplished?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800")??""}`)}),_(Lt,Ot)}),e(st),e(d),e(ht);var X=r(ht,2),T=a(X),ct=a(T);O(()=>g(ct,`Showing ${(t(xt)-1)*t(kt)+1} to ${Math.min(t(xt)*t(kt),t(dt).length)??""} of ${t(dt).length??""} results`)),e(T);var F=r(T,2),z=a(F),vt=a(z);vt.value=(vt.__value=5)==null?"":5;var ut=r(vt);ut.value=(ut.__value=10)==null?"":10;var nt=r(ut);nt.value=(nt.__value=25)==null?"":25;var Tt=r(nt);Tt.value=(Tt.__value=50)==null?"":50,e(z);var gt=r(z,2),Mt=a(gt);Mt.__click=[zr,xt];var It=r(Mt,2);It.__click=[Dr,xt],e(gt),e(F),e(X),O(()=>{Mt.disabled=t(xt)===1,It.disabled=t(xt)===t(Bt)}),ie(z,()=>t(kt),Lt=>i(kt,Lt)),_(D,M)},D=>{var M=Fr();_(D,M)},!0),_(c,C)}),e(N);var H=r(N,2);rt(H,()=>t(x),c=>{var C=Tr(),q=a(C),D=a(q),M=r(a(D),2);M.__click=Qt;var ht=a(M);De(ht,{size:20}),e(M),e(D);var d=r(D,2),f=a(d),k=r(a(f),2),h=a(k,!0);e(k),e(f);var b=r(f,2),R=r(a(b),2),Z=a(R,!0);e(R),e(b);var G=r(b,2),B=r(a(G),2),lt=a(B,!0);e(B),e(G);var it=r(G,2),st=r(a(it),2);ea(st),e(it);var X=r(it,2),T=a(X);T.__click=Qt;var ct=r(T,2);ct.__click=[kr,E,bt,I,Q,Qt];var F=a(ct,!0);e(ct),e(X),e(d),e(q),e(C),O(()=>{var z,vt,ut,nt;g(h,(z=t(E))==null?void 0:z.actions_taken),g(Z,(vt=t(E))==null?void 0:vt.kpi),g(lt,(ut=t(E))==null?void 0:ut.target_output),ct.disabled=!t(Q)||((nt=t(E))==null?void 0:nt.isLoading)||t(bt),g(F,t(bt)?"Submitting...":"Submit")}),ye(st,()=>t(Q),z=>i(Q,z)),he(3,C,()=>$e,()=>({duration:200})),_(c,C)});var ot=r(H,2);rt(ot,()=>t(et),c=>{var C=Gr(),q=a(C),D=a(q),M=r(a(D),2);M.__click=[Ir,et];var ht=a(M);De(ht,{size:20}),e(M),e(D);var d=r(D,2),f=a(d),k=a(f,!0);e(f);var h=r(f,2),b=a(h);b.__click=[Vr,et],e(h),e(d),e(q),e(C),O(()=>g(k,t(Y))),he(3,C,()=>$e,()=>({duration:200})),_(c,C)}),e(Pt),ye(qt,()=>t(v),c=>i(v,c)),ie(Wt,()=>t(w),c=>i(w,c)),ie(U,()=>t(l),c=>i(l,c)),_(m,Pt),ke()}Pe(["click"]);const Xe=(m,o)=>{o()},Kr=async(m,o,v,u,n)=>{var w;try{const{error:l}=await wt.from("risk_monitoring").update({likelihood_rating_id:t(o).likelihoodRating,severity_id:t(o).severity,control_rating_id:t(o).riskControlRating,monitoring_rating_id:t(o).riskMonitoringRating}).eq("id",(w=t(v))==null?void 0:w.id);if(l)throw l;i(u,!1),i(v,null),await n()}catch(l){console.error("Failed to save risk assessment:",l)}},Ur=(m,o,v,u,n)=>{i(o,"all"),i(v,"all"),i(u,"all"),i(n,"")};var Yr=$("<option> </option>"),Hr=$("<option> </option>"),Br=$("<option> </option>"),Jr=$('<div class="flex justify-center p-8"><!></div>'),Qr=$('<div class="flex items-center p-4 rounded-lg bg-red-100 text-red-800"><span> </span></div>'),Zr=(m,o)=>o("rrn"),Wr=(m,o)=>o("risk_statement"),Xr=(m,o,v)=>o(t(v)),to=$('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><span> </span></td><td class="px-4 py-3"> </td><td class="px-4 py-3"><div class="flex justify-center gap-2"><button class="p-1.5 hover:bg-primary/10 rounded-md transition-colors text-primary" title="Add Re-Assessment"><!></button></div></td></tr>'),eo=(m,o)=>Se(o,-1),ao=(m,o)=>Se(o),ro=$('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">RRN <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Risk Statement <!></button></th><th class="px-4 py-3 text-left">Likelihood Rating</th><th class="px-4 py-3 text-left">Severity</th><th class="px-4 py-3 text-left">Control Rating</th><th class="px-4 py-3 text-left">Monitoring Rating</th><th class="px-4 py-3 text-center">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring"><option>5 per page</option><option>10 per page</option><option>25 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Next</button></div></div></div>',1),oo=$("<option> </option>"),io=$("<option> </option>"),so=$('<p class="text-sm"> </p>'),lo=$('<p class="text-sm text-muted-foreground">Select Likelihood and Severity first</p>'),no=$("<option> </option>"),co=$('<div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"><div class="bg-card rounded-lg shadow-lg max-w-md w-full"><div class="flex justify-between items-center p-4 border-b border-border"><h3 class="text-lg font-semibold">Edit Risk Assessment</h3> <button class="text-muted-foreground hover:text-foreground"><!></button></div> <div class="p-6 space-y-4"><div><h4 class="text-sm font-medium text-muted-foreground">Risk Statement</h4> <p class="text-sm"> </p></div> <div class="space-y-2"><label class="text-sm font-medium">Likelihood Rating</label> <select class="w-full px-3 py-2 bg-secondary rounded-lg focus:ring-2 focus:ring-ring"><option>Select Likelihood</option><!></select></div> <div class="space-y-2"><label class="text-sm font-medium">Severity</label> <select class="w-full px-3 py-2 bg-secondary rounded-lg focus:ring-2 focus:ring-ring"><option>Select Severity</option><!></select></div> <div class="space-y-2"><label class="text-sm font-medium">Control Rating</label> <div class="mt-1 p-2 bg-muted rounded-lg"><!></div></div> <div class="space-y-2"><label class="text-sm font-medium">Monitoring Rating</label> <select class="w-full px-3 py-2 bg-secondary rounded-lg focus:ring-2 focus:ring-ring"><option>Select Monitoring Rating</option><!></select></div></div> <div class="p-4 flex justify-end gap-2 border-t border-border"><button class="px-4 py-2 text-sm font-medium hover:bg-muted rounded-lg">Cancel</button> <button class="px-4 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50">Save Changes</button></div></div></div>'),vo=$('<div class="flex flex-col gap-4 p-4 container mx-auto"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Risk Monitoring</h1></div></div></div> <div class="grid gap-4"><div class="flex flex-col md:flex-row gap-4 items-center justify-between"><div class="relative flex-1 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search risks..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div></div> <div class="grid sm:grid-cols-4 gap-4"><select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring"><option>All Likelihood</option><!></select> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring"><option>All Severity</option><!></select> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring"><option>All Control Rating</option><!></select> <button class="px-4 py-2 bg-secondary text-foreground rounded-lg hover:bg-secondary/80">Reset Filters</button></div></div> <!> <!></div>');function vi(m,o){we(o,!0);let v=s(y([])),u=s(!0),n=s(null),w=s(!1),l=s(null),x=s(""),E=s(1),Q=s(5),et=s("rrn"),Y=s("asc"),ft=s("all"),I=s("all"),pt=s("all"),bt=s(y([])),xt=s(y([])),kt=s(y([])),At=s(y([])),dt=s(y({likelihoodRating:null,severity:null,riskControlRating:null,riskMonitoringRating:null}));const jt=d=>{if(!d)return"bg-gray-100 text-gray-800";const f=d.toLowerCase();return f.includes("high")?"bg-red-100 text-red-800":f.includes("medium")?"bg-yellow-100 text-yellow-800":f.includes("low")?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"},Bt=async()=>{try{const{data:d}=await wt.auth.getSession();if(!(d!=null&&d.session))throw new Error("User not logged in");const f=d.session.user.id,{data:k,error:h}=await wt.from("profiles").select("department_id").eq("id",f).single();if(h||!(k!=null&&k.department_id))throw new Error("Failed to fetch user department");const b=k.department_id,{data:R,error:Z}=await wt.from("risk_monitoring").select(`
					id,
					risks (
						rrn,
						risk_statement
					),
					likelihood_rating:likelihood_rating_id(name),
					severity:severity_id(name),
					control_rating:control_rating_id(name),
					monitoring_rating:monitoring_rating_id(status),
					is_achieved
				`).eq("department_id",b);if(Z)throw Z;i(v,y(R.map(G=>{var B,lt,it,st;return{id:G.id,rrn:G.risks.rrn,risk_statement:G.risks.risk_statement,likelihood_rating:((B=G.likelihood_rating)==null?void 0:B.name)||"Not Available",severity:((lt=G.severity)==null?void 0:lt.name)||"Not Available",control_rating:((it=G.control_rating)==null?void 0:it.name)||"Not Available",monitoring_rating:((st=G.monitoring_rating)==null?void 0:st.status)||"Not Available",is_achieved:G.is_achieved}}).sort((G,B)=>G.rrn.localeCompare(B.rrn))))}catch(d){console.error("Error fetching risk monitoring data:",d),i(n,"Failed to fetch risk monitoring data.")}finally{i(u,!1)}},oe=async()=>{try{const[d,f,k,h]=await Promise.all([wt.from("likelihood_rating").select("*"),wt.from("severity").select("*"),wt.from("risk_control_rating").select("*"),wt.from("risk_monitoring_rating").select("*")]);if(d.error||f.error||k.error||h.error)throw new Error("Failed to fetch dropdown options");i(bt,y(d.data)),i(xt,y(f.data)),i(kt,y(k.data)),i(At,y(h.data))}catch(d){console.error("Error fetching dropdown options:",d)}},Jt=d=>{var f,k,h,b;i(l,y(d)),i(dt,y({likelihoodRating:((f=t(bt).find(R=>R.name===d.likelihood_rating))==null?void 0:f.id)||null,severity:((k=t(xt).find(R=>R.name===d.severity))==null?void 0:k.id)||null,riskControlRating:((h=t(kt).find(R=>R.name===d.control_rating))==null?void 0:h.id)||null,riskMonitoringRating:((b=t(At).find(R=>R.status===d.monitoring_rating))==null?void 0:b.id)||null})),t(dt).riskControlRating,i(w,!0)},Qt=async()=>{var d,f,k,h,b;if(!(!t(dt).likelihoodRating||!t(dt).severity||!t(l)))try{const{data:R,error:Z}=await wt.from("risk_monitoring").select("control_rating_id").eq("id",t(l).id).single();if(Z||!R){console.error("Failed to fetch current control rating:",Z);return}const G=R.control_rating_id,B=t(kt).find(X=>X.id===G),lt=(B==null?void 0:B.value)||0,it=(d=t(bt).find(X=>X.id===t(dt).likelihoodRating))==null?void 0:d.symbol,st=(f=t(xt).find(X=>X.id===t(dt).severity))==null?void 0:f.value;if(it&&st){const{controlRating:X}=ha(it,st),T=t(kt).find(z=>z.symbol===X),ct=(T==null?void 0:T.id)||null;ct&&t(dt).riskControlRating!==ct&&(t(dt).riskControlRating=ct);let F=null;(T==null?void 0:T.value)>lt?F=(k=t(At).find(z=>z.status==="Grading Increased"))==null?void 0:k.id:(T==null?void 0:T.value)<lt?F=(h=t(At).find(z=>z.status==="Grading Decreased"))==null?void 0:h.id:(T==null?void 0:T.value)===lt&&(F=(b=t(At).find(z=>z.status==="No Change to Grade"))==null?void 0:b.id),F&&t(dt).riskMonitoringRating!==F&&(t(dt).riskMonitoringRating=F)}}catch(R){console.error("Error updating monitoring rating:",R)}},V=()=>{i(w,!1),i(l,null)},J=d=>{t(et)===d?i(Y,y(t(Y)==="asc"?"desc":"asc")):(i(et,y(d)),i(Y,"asc")),t(v).sort((f,k)=>{const h=String(f[d]),b=String(k[d]);return t(Y)==="asc"?h.localeCompare(b):b.localeCompare(h)})},W=_t(()=>t(v).filter(d=>{var Z,G,B;const k=`${d.rrn} ${d.risk_statement}`.toLowerCase().includes(t(x).toLowerCase()),h=t(ft)==="all"||((Z=d.likelihood_rating)==null?void 0:Z.toLowerCase())===t(ft).toLowerCase(),b=t(I)==="all"||((G=d.severity)==null?void 0:G.toLowerCase())===t(I).toLowerCase(),R=t(pt)==="all"||((B=d.control_rating)==null?void 0:B.toLowerCase())===t(pt).toLowerCase();return k&&h&&b&&R})),Et=_t(()=>t(W).slice((t(E)-1)*t(Q),t(E)*t(Q))),Pt=_t(()=>Math.ceil(t(W).length/t(Q)));Te(()=>{Bt(),oe()});var Gt=vo(),Rt=a(Gt),Zt=a(Rt),ae=a(Zt),le=a(ae);oa(le,{class:"w-8 h-8 text-primary"}),Ct(2),e(ae),e(Zt),e(Rt);var zt=r(Rt,2),Dt=a(zt),qt=a(Dt),Wt=a(qt);Le(Wt,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var Kt=r(Wt,2);Me(Kt),e(qt),e(Dt);var Xt=r(Dt,2),Ut=a(Xt),U=a(Ut);U.value=(U.__value="all")==null?"":"all";var N=r(U);ee(N,17,()=>t(bt),se,(d,f)=>{var k=Yr(),h={},b=a(k,!0);e(k),O(()=>{h!==(h=t(f).name)&&(k.value=(k.__value=t(f).name)==null?"":t(f).name),g(b,t(f).name)}),_(d,k)}),e(Ut);var P=r(Ut,2),H=a(P);H.value=(H.__value="all")==null?"":"all";var ot=r(H);ee(ot,17,()=>t(xt),se,(d,f)=>{var k=Hr(),h={},b=a(k,!0);e(k),O(()=>{h!==(h=t(f).name)&&(k.value=(k.__value=t(f).name)==null?"":t(f).name),g(b,t(f).name)}),_(d,k)}),e(P);var c=r(P,2),C=a(c);C.value=(C.__value="all")==null?"":"all";var q=r(C);ee(q,17,()=>t(kt),se,(d,f)=>{var k=Br(),h={},b=a(k,!0);e(k),O(()=>{h!==(h=t(f).name)&&(k.value=(k.__value=t(f).name)==null?"":t(f).name),g(b,t(f).name)}),_(d,k)}),e(c);var D=r(c,2);D.__click=[Ur,ft,I,pt,x],e(Xt),e(zt);var M=r(zt,2);rt(M,()=>t(u),d=>{var f=Jr(),k=a(f);ze(k,{class:"animate-spin h-8 w-8 text-primary"}),e(f),_(d,f)},d=>{var f=ue(),k=St(f);rt(k,()=>t(n),h=>{var b=Qr(),R=a(b),Z=a(R,!0);e(R),e(b),O(()=>g(Z,t(n))),he(3,b,()=>$e),_(h,b)},h=>{var b=ro(),R=St(b),Z=a(R),G=a(Z),B=a(G),lt=a(B),it=a(lt);it.__click=[Zr,J];var st=r(a(it)),X=_t(()=>t(et)==="rrn"?"text-primary":"");be(st,{size:16,get class(){return t(X)}}),e(it),e(lt);var T=r(lt),ct=a(T);ct.__click=[Wr,J];var F=r(a(ct)),z=_t(()=>t(et)==="risk_statement"?"text-primary":"");be(F,{size:16,get class(){return t(z)}}),e(ct),e(T),Ct(5),e(B),e(G);var vt=r(G);ee(vt,21,()=>t(Et),$t=>$t.id,($t,re)=>{var tt=to(),at=a(tt),yt=a(at,!0);e(at);var Yt=r(at),p=a(Yt,!0);e(Yt);var S=r(Yt),j=a(S,!0);e(S);var L=r(S),A=a(L,!0);e(L);var K=r(L),Ft=a(K);const Ht=_t(()=>`px-2 py-1 rounded-full text-xs font-medium ${jt(t(re).control_rating)}`);var pe=a(Ft,!0);e(Ft),e(K);var ce=r(K),ne=a(ce,!0);e(ce);var de=r(ce),te=a(de),Nt=a(te);Nt.__click=[Xr,Jt,re];var ve=a(Nt);ya(ve,{size:18}),e(Nt),e(te),e(de),e(tt),O(()=>{g(yt,t(re).rrn),g(p,t(re).risk_statement),g(j,t(re).likelihood_rating),g(A,t(re).severity),fe(Ft,t(Ht)),g(pe,t(re).control_rating||"N/A"),g(ne,t(re).monitoring_rating)}),_($t,tt)}),e(vt),e(Z),e(R);var ut=r(R,2),nt=a(ut),Tt=a(nt);O(()=>g(Tt,`Showing ${(t(E)-1)*t(Q)+1} to ${Math.min(t(E)*t(Q),t(W).length)??""} of ${t(W).length??""} results`)),e(nt);var gt=r(nt,2),Mt=a(gt),It=a(Mt);It.value=(It.__value=5)==null?"":5;var Lt=r(It);Lt.value=(Lt.__value=10)==null?"":10;var mt=r(Lt);mt.value=(mt.__value=25)==null?"":25,e(Mt);var Ot=r(Mt,2),Vt=a(Ot);Vt.__click=[eo,E];var _e=r(Vt,2);_e.__click=[ao,E],e(Ot),e(gt),e(ut),O(()=>{Vt.disabled=t(E)===1,_e.disabled=t(E)===t(Pt)}),ie(Mt,()=>t(Q),$t=>i(Q,$t)),_(h,b)},!0),_(d,f)});var ht=r(M,2);rt(ht,()=>t(w),d=>{var f=ue(),k=St(f);rt(k,()=>t(w),h=>{var b=co(),R=a(b),Z=a(R),G=r(a(Z),2);G.__click=V;var B=a(G);De(B,{class:"w-5 h-5"}),e(G),e(Z);var lt=r(Z,2),it=a(lt),st=r(a(it),2),X=a(st,!0);e(st),e(it);var T=r(it,2),ct=r(a(T),2);ct.__change=[Xe,Qt];var F=a(ct);F.value=(F.__value=null)==null?"":null;var z=r(F);ee(z,17,()=>t(bt),se,(tt,at)=>{var yt=oo(),Yt={},p=a(yt,!0);e(yt),O(()=>{Yt!==(Yt=t(at).id)&&(yt.value=(yt.__value=t(at).id)==null?"":t(at).id),g(p,t(at).name)}),_(tt,yt)}),e(ct),e(T);var vt=r(T,2),ut=r(a(vt),2);ut.__change=[Xe,Qt];var nt=a(ut);nt.value=(nt.__value=null)==null?"":null;var Tt=r(nt);ee(Tt,17,()=>t(xt),se,(tt,at)=>{var yt=io(),Yt={},p=a(yt,!0);e(yt),O(()=>{Yt!==(Yt=t(at).id)&&(yt.value=(yt.__value=t(at).id)==null?"":t(at).id),g(p,t(at).name)}),_(tt,yt)}),e(ut),e(vt);var gt=r(vt,2),Mt=r(a(gt),2),It=a(Mt);rt(It,()=>t(dt).riskControlRating,tt=>{var at=so();const yt=_t(()=>t(kt).find(p=>p.id===t(dt).riskControlRating));var Yt=a(at,!0);e(at),O(()=>{var p;return g(Yt,((p=t(yt))==null?void 0:p.name)||"Not Available")}),_(tt,at)},tt=>{var at=lo();_(tt,at)}),e(Mt),e(gt);var Lt=r(gt,2),mt=r(a(Lt),2),Ot=a(mt);Ot.value=(Ot.__value=null)==null?"":null;var Vt=r(Ot);ee(Vt,17,()=>t(At),se,(tt,at)=>{var yt=no(),Yt={},p=a(yt);e(yt),O(()=>{Yt!==(Yt=t(at).id)&&(yt.value=(yt.__value=t(at).id)==null?"":t(at).id),g(p,`${t(at).value??""} - ${t(at).status??""}`)}),_(tt,yt)}),e(mt),e(Lt),e(lt);var _e=r(lt,2),$t=a(_e);$t.__click=V;var re=r($t,2);re.__click=[Kr,dt,l,w,Bt],e(_e),e(R),e(b),O(()=>{var tt;return g(X,(tt=t(l))==null?void 0:tt.risk_statement)}),ie(ct,()=>t(dt).likelihoodRating,tt=>t(dt).likelihoodRating=tt),ie(ut,()=>t(dt).severity,tt=>t(dt).severity=tt),ie(mt,()=>t(dt).riskMonitoringRating,tt=>t(dt).riskMonitoringRating=tt),_(h,b)}),_(d,f)}),e(Gt),ye(Kt,()=>t(x),d=>i(x,d)),ie(Ut,()=>t(ft),d=>i(ft,d)),ie(P,()=>t(I),d=>i(I,d)),ie(c,()=>t(pt),d=>i(pt,d)),_(m,Gt),ke()}Pe(["click","change"]);async function uo(m,o,v,u,n,w){if(t(o)){i(v,!0),i(u,y(t(u).map(l=>l.id===t(o).id?{...l,isLoading:!0}:l)));try{const l=await fetch("/api/evaluate-goal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target:t(o).goal,evaluation:t(n)})}),x=await l.json();if(!l.ok||x.error)throw new Error(x.error||"Failed to evaluate goal.");const E=x.aiEvaluation;if(typeof E!="string")throw new TypeError("AI evaluation response is not a valid string.");const et=!["not achieved","unsuccessful","failed","incomplete","fell short","below target","did not meet","not","not been achieved"].some(I=>E.toLowerCase().includes(I)),Y=et?new Date().toISOString():null,{error:ft}=await wt.from("opt_monitoring").update({time_completed:Y,evaluation:t(n),statement:E,is_accomplished:et}).eq("opt_id",t(o).id);ft?console.error("[ERROR] Error updating opt_monitoring:",ft):(i(u,y(t(u).map(I=>I.id===t(o).id?{...I,achieved:et?"Achieved":"Not Achieved",isLoading:!1,timeCompleted:Y,aiStatement:E,evaluation:t(n)}:I))),w())}catch(l){console.error("[ERROR] Error evaluating goal:",l),i(u,y(t(u).map(x=>x.id===t(o).id?{...x,isLoading:!1}:x)))}finally{i(v,!1)}}}var _o=$('<div class="flex items-center justify-center min-h-screen"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),po=(m,o)=>o("opt_statement"),go=(m,o)=>o("kpi"),mo=(m,o,v)=>o(t(v)),fo=$('<button class="shrink-0 inline-flex items-center px-3 py-1 text-sm bg-primary text-primary-foreground hover:bg-primary/90 rounded-md">Evaluate</button>'),bo=$('<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-current"></div>'),xo=$("<!> Achieved",1),ho=$("<!> Not Achieved",1),yo=$("<!> Pending",1),wo=$('<div class="text-xs text-muted-foreground mt-1"> </div>'),ko=(m,o,v)=>o(t(v).aiStatement||""),$o=$('<button class="inline-flex items-center gap-1.5 px-2.5 py-1.5 text-sm text-primary bg-primary/10 hover:bg-primary/20 rounded-md"><!> View</button>'),So=$('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><!></td><td class="px-4 py-3"><span><!></span> <!></td><td class="px-4 py-3"><div class="flex items-center justify-center"><!></div></td></tr>'),Ao=(m,o)=>i(o,t(o)-1),No=(m,o)=>i(o,t(o)+1),Co=$('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Statement <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">KPI <!></button></th><th class="px-4 py-3 text-left">Target Output</th><th class="px-4 py-3 text-left">Actions Taken</th><th class="px-4 py-3 text-left">Status</th><th class="px-4 py-3 text-center">View Statement</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring w-full sm:w-auto"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>',1),Eo=$('<div class="text-center py-12 bg-card rounded-lg shadow"><p class="text-muted-foreground">No opportunities found.</p></div>'),Po=$('<div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"><div class="bg-background rounded-lg shadow-xl w-full max-w-lg mx-4"><div class="flex items-center justify-between p-4 border-b border-border"><h2 class="text-lg font-semibold">Evaluate Opportunity</h2> <button class="p-1 hover:bg-muted rounded-full"><!></button></div> <div class="p-4"><div class="mb-4"><label class="block text-sm font-medium mb-1">Statement</label> <p class="text-muted-foreground"> </p></div> <div class="mb-4"><label class="block text-sm font-medium mb-1">KPI</label> <p class="text-muted-foreground"> </p></div> <div class="mb-4"><label class="block text-sm font-medium mb-1">Target Output</label> <p class="text-muted-foreground"> </p></div> <div class="mb-6"><label class="block text-sm font-medium mb-1">Evaluation</label> <textarea class="w-full h-32 px-3 py-2 text-sm bg-secondary rounded-md border border-border focus:outline-none focus:ring-2 focus:ring-ring resize-none" placeholder="Enter your evaluation..."></textarea></div> <div class="flex justify-end gap-3"><button class="px-4 py-2 text-sm hover:bg-muted rounded-md">Cancel</button> <button class="px-4 py-2 text-sm bg-primary text-primary-foreground hover:bg-primary/90 rounded-md"> </button></div></div></div></div>'),Mo=(m,o)=>i(o,!1),Lo=(m,o)=>i(o,!1),jo=$('<div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"><div class="bg-background rounded-lg shadow-xl w-full max-w-lg mx-4"><div class="flex items-center justify-between p-4 border-b border-border"><h2 class="text-lg font-semibold">Evaluation Statement</h2> <button class="p-1 hover:bg-muted rounded-full"><!></button></div> <div class="p-4"><div class="bg-muted rounded-lg p-4 text-muted-foreground max-h-[60vh] overflow-y-auto break-words"> </div> <div class="flex justify-end mt-4"><button class="px-4 py-2 text-sm bg-primary text-primary-foreground hover:bg-primary/90 rounded-md">Close</button></div></div></div></div>'),Ro=$('<div class="flex flex-col gap-4 p-4 container mx-auto min-h-screen bg-background text-foreground"><div class="flex flex-col gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Opportunities Monitoring</h1></div> <div class="flex flex-col sm:flex-row gap-4"><div class="relative flex-1 sm:flex-none max-w-[300px]"><!> <input type="search" placeholder="Search opportunities..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full sm:w-[200px]"><option>All Status</option><option>Achieved</option><option>Pending</option></select></div></div> <div class="flex-1"><!></div> <!> <!></div>');function ui(m,o){we(o,!0);let v=s(y([])),u=s(null),n=s(!0),w=s(!1),l=s(""),x=s(!1),E=s(null),Q=s(""),et=s(""),Y=s("opt_statement"),ft=s(!0),I=s("all"),pt=s(!1),bt=s(1),xt=s(5),kt=s(y([]));const At=_t(()=>t(kt).filter(N=>{const P=N.statement.toLowerCase().includes(t(et).toLowerCase())||N.goal.toLowerCase().includes(t(et).toLowerCase()),H=t(I)==="all"?!0:t(I)==="achieved"?N.achieved==="Achieved":N.achieved!=="Achieved";return P&&H})),dt=_t(()=>t(At).sort((N,P)=>{const H=t(ft)?1:-1,ot=t(Y)==="opt_statement"?N.statement:N.goal,c=t(Y)==="opt_statement"?P.statement:P.goal;return ot>c?H:-H}).slice((t(bt)-1)*t(xt),t(bt)*t(xt))),jt=_t(()=>Math.ceil(t(At).length/t(xt))),Bt=N=>{t(Y)===N?i(ft,!t(ft)):(i(Y,y(N)),i(ft,!0))};function oe(N){i(l,y(N)),i(w,!0)}function Jt(N){i(E,y(N)),i(Q,y(N.evaluation)),i(x,!0)}function Qt(){i(x,!1),i(E,null),i(Q,"")}const V=async()=>{const{data:{session:N},error:P}=await wt.auth.getSession();if(P||!N){console.error("Error fetching session:",P);return}const{user:H}=N,{data:ot,error:c}=await wt.from("profiles").select("id").eq("id",H.id).single();if(c||!ot){console.error("Error fetching profile:",c);return}i(u,y(ot.id))},J=async()=>{try{const{data:N,error:P}=await wt.from("profiles").select("department_id").eq("id",t(u)).single();if(P||!(N!=null&&N.department_id)){console.error("Error fetching user profile or department:",P);return}const H=N.department_id,{data:ot,error:c}=await wt.from("profiles").select("id").eq("department_id",H);if(c){console.error("Error fetching profile IDs:",c);return}const C=ot.map(M=>M.id),{data:q,error:D}=await wt.from("opt_monitoring").select(`
                    opt_id,
                    time_completed,
                    evaluation,
                    statement,
                    opportunities (opt_statement, kpi, target_output, planned_actions)
                `).in("profile_id",C);if(D){console.error("Error fetching opportunities:",D);return}i(v,y(q.map(M=>{var ht,d,f,k;return{opt_id:M.opt_id,opt_statement:((ht=M.opportunities)==null?void 0:ht.opt_statement)||"No Statement",kpi:((d=M.opportunities)==null?void 0:d.kpi)||"No KPI",target_output:((f=M.opportunities)==null?void 0:f.target_output)||"No Target Output",planned_actions:((k=M.opportunities)==null?void 0:k.planned_actions)||"No Actions Taken",time_completed:M.time_completed,evaluation:M.evaluation||"",statement:M.statement||null}}))),i(kt,y(t(v).map(M=>({id:M.opt_id,statement:M.opt_statement,kpi:M.kpi,goal:M.target_output,evaluation:M.evaluation||"",achieved:M.time_completed?"Achieved":null,isLoading:!1,timeCompleted:M.time_completed,aiStatement:M.statement||null}))))}catch(N){console.error("Error fetching opportunities:",N)}finally{i(n,!1)}};Te(async()=>{await V(),await J()});var W=Ro(),Et=a(W),Pt=a(Et),Gt=a(Pt);ia(Gt,{class:"w-8 h-8 text-primary"}),Ct(2),e(Pt);var Rt=r(Pt,2),Zt=a(Rt),ae=a(Zt);Le(ae,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var le=r(ae,2);Me(le),e(Zt);var zt=r(Zt,2),Dt=a(zt);Dt.value=(Dt.__value="all")==null?"":"all";var qt=r(Dt);qt.value=(qt.__value="achieved")==null?"":"achieved";var Wt=r(qt);Wt.value=(Wt.__value="pending")==null?"":"pending",e(zt),e(Rt),e(Et);var Kt=r(Et,2),Xt=a(Kt);rt(Xt,()=>t(n),N=>{var P=_o();_(N,P)},N=>{var P=ue(),H=St(P);rt(H,()=>t(dt).length>0,ot=>{var c=Co(),C=St(c),q=a(C),D=a(q),M=a(D),ht=a(M),d=a(ht);d.__click=[po,Bt];var f=r(a(d)),k=_t(()=>t(Y)==="opt_statement"?"text-primary":"");be(f,{size:16,get class(){return t(k)}}),e(d),e(ht);var h=r(ht),b=a(h);b.__click=[go,Bt];var R=r(a(b)),Z=_t(()=>t(Y)==="kpi"?"text-primary":"");be(R,{size:16,get class(){return t(Z)}}),e(b),e(h),Ct(4),e(M),e(D);var G=r(D);ee(G,21,()=>t(dt),se,(Tt,gt)=>{var Mt=So(),It=a(Mt),Lt=a(It,!0);e(It);var mt=r(It),Ot=a(mt,!0);e(mt);var Vt=r(mt),_e=a(Vt,!0);e(Vt);var $t=r(Vt),re=a($t);rt(re,()=>t(gt).achieved==="Achieved",L=>{var A=ta();O(()=>g(A,t(gt).evaluation||"No evaluation")),_(L,A)},L=>{var A=fo();A.__click=[mo,Jt,gt],_(L,A)}),e($t);var tt=r($t),at=a(tt),yt=a(at);rt(yt,()=>t(gt).isLoading,L=>{var A=bo();_(L,A)},L=>{var A=ue(),K=St(A);rt(K,()=>t(gt).achieved==="Achieved",Ft=>{var Ht=xo(),pe=St(Ht);la(pe,{size:14}),Ct(),_(Ft,Ht)},Ft=>{var Ht=ue(),pe=St(Ht);rt(pe,()=>t(gt).achieved==="Not Achieved",ce=>{var ne=ho(),de=St(ne);Qe(de,{size:14}),Ct(),_(ce,ne)},ce=>{var ne=yo(),de=St(ne);Qe(de,{size:14}),Ct(),_(ce,ne)},!0),_(Ft,Ht)},!0),_(L,A)}),e(at);var Yt=r(at,2);rt(Yt,()=>t(gt).timeCompleted,L=>{var A=wo(),K=a(A,!0);O(()=>g(K,new Date(t(gt).timeCompleted).toLocaleDateString())),e(A),_(L,A)}),e(tt);var p=r(tt),S=a(p),j=a(S);rt(j,()=>t(gt).aiStatement,L=>{var A=$o();A.__click=[ko,oe,gt];var K=a(A);sa(K,{size:16}),Ct(),e(A),_(L,A)}),e(S),e(p),e(Mt),O(()=>{g(Lt,t(gt).statement),g(Ot,t(gt).kpi),g(_e,t(gt).goal),fe(at,`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium ${(t(gt).achieved==="Achieved"?"bg-green-100 text-green-800":t(gt).achieved==="Not Achieved"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800")??""}`)}),_(Tt,Mt)}),e(G),e(q),e(C);var B=r(C,2),lt=a(B),it=a(lt);O(()=>g(it,`Showing ${(t(bt)-1)*t(xt)+1} to ${Math.min(t(bt)*t(xt),t(At).length)??""} of ${t(At).length??""} results`)),e(lt);var st=r(lt,2),X=a(st),T=a(X);T.value=(T.__value=5)==null?"":5;var ct=r(T);ct.value=(ct.__value=10)==null?"":10;var F=r(ct);F.value=(F.__value=25)==null?"":25;var z=r(F);z.value=(z.__value=50)==null?"":50,e(X);var vt=r(X,2),ut=a(vt);ut.__click=[Ao,bt];var nt=r(ut,2);nt.__click=[No,bt],e(vt),e(st),e(B),O(()=>{ut.disabled=t(bt)===1,nt.disabled=t(bt)===t(jt)}),ie(X,()=>t(xt),Tt=>i(xt,Tt)),_(ot,c)},ot=>{var c=Eo();_(ot,c)},!0),_(N,P)}),e(Kt);var Ut=r(Kt,2);rt(Ut,()=>t(x),N=>{var P=Po(),H=a(P),ot=a(H),c=r(a(ot),2);c.__click=Qt;var C=a(c);De(C,{size:20}),e(c),e(ot);var q=r(ot,2),D=a(q),M=r(a(D),2),ht=a(M,!0);e(M),e(D);var d=r(D,2),f=r(a(d),2),k=a(f,!0);e(f),e(d);var h=r(d,2),b=r(a(h),2),R=a(b,!0);e(b),e(h);var Z=r(h,2),G=r(a(Z),2);ea(G),e(Z);var B=r(Z,2),lt=a(B);lt.__click=Qt;var it=r(lt,2);it.__click=[uo,E,pt,kt,Q,Qt];var st=a(it,!0);e(it),e(B),e(q),e(H),e(P),O(()=>{var X,T,ct,F,z;g(ht,(X=t(E))==null?void 0:X.statement),g(k,(T=t(E))==null?void 0:T.kpi),g(R,(ct=t(E))==null?void 0:ct.goal),it.disabled=!t(Q)||((F=t(E))==null?void 0:F.isSubmitting),g(st,(z=t(E))!=null&&z.isSubmitting?"Evaluating...":"Submit")}),ye(G,()=>t(Q),X=>i(Q,X)),he(3,H,()=>We,()=>({duration:200})),he(3,P,()=>$e,()=>({duration:200})),_(N,P)});var U=r(Ut,2);rt(U,()=>t(w),N=>{var P=jo(),H=a(P),ot=a(H),c=r(a(ot),2);c.__click=[Mo,w];var C=a(c);De(C,{size:20}),e(c),e(ot);var q=r(ot,2),D=a(q),M=a(D,!0);e(D);var ht=r(D,2),d=a(ht);d.__click=[Lo,w],e(ht),e(q),e(H),e(P),O(()=>g(M,t(l))),he(3,H,()=>We,()=>({duration:200})),he(3,P,()=>$e,()=>({duration:200})),_(N,P)}),e(W),ye(le,()=>t(et),N=>i(et,N)),ie(zt,()=>t(I),N=>i(I,N)),_(m,W),ke()}Pe(["click"]);export{li as A,ci as D,si as M,ni as a,di as b,vi as c,ui as d};
